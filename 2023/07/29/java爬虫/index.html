<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>java爬虫 | XYTX-荒岛</title><meta name="author" content="小逸"><meta name="copyright" content="小逸"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="1.爬虫基础概念1.1爬虫是什么       爬虫又叫网络爬虫，网络蜘蛛，一种运行在互联网上用来获取数据的的自动程序。  互联网的数据，有很多，一般都是根据业务需求来的。 网页（文字、图片、视频） 商品数据   怎么获取数据？	 HTTP协议 人的操是通过浏览器的，程序是利用网络请求的相关协议获取数据。   自动化，尽可能减少人工的干预。 爬虫开发的技术，没有限制的。 python做网络爬虫是非常">
<meta property="og:type" content="article">
<meta property="og:title" content="java爬虫">
<meta property="og:url" content="http://example.com/2023/07/29/java%E7%88%AC%E8%99%AB/index.html">
<meta property="og:site_name" content="XYTX-荒岛">
<meta property="og:description" content="1.爬虫基础概念1.1爬虫是什么       爬虫又叫网络爬虫，网络蜘蛛，一种运行在互联网上用来获取数据的的自动程序。  互联网的数据，有很多，一般都是根据业务需求来的。 网页（文字、图片、视频） 商品数据   怎么获取数据？	 HTTP协议 人的操是通过浏览器的，程序是利用网络请求的相关协议获取数据。   自动化，尽可能减少人工的干预。 爬虫开发的技术，没有限制的。 python做网络爬虫是非常">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s3.bmp.ovh/imgs/2023/07/23/e724b3d3dbbd4e38.jpg">
<meta property="article:published_time" content="2023-07-29T10:18:08.000Z">
<meta property="article:modified_time" content="2023-07-29T10:23:42.129Z">
<meta property="article:author" content="小逸">
<meta property="article:tag" content="java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s3.bmp.ovh/imgs/2023/07/23/e724b3d3dbbd4e38.jpg"><link rel="shortcut icon" href="https://s3.bmp.ovh/imgs/2023/07/21/90cd05fda14751fd.png"><link rel="canonical" href="http://example.com/2023/07/29/java%E7%88%AC%E8%99%AB/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: 小逸","link":"链接: ","source":"来源: XYTX-荒岛","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'java爬虫',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-07-29 18:23:42'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s3.bmp.ovh/imgs/2023/07/21/9c73c560053d585c.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 学习</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/java/"><i class="fa-fw fas fa-music"></i><span> java开发</span></a></li><li><a class="site-page child" href="/vue/"><i class="fa-fw fas fa-images"></i><span> vue学习</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/meitu/"><i class="fa-fw fas fa-images"></i><span> 美图</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s3.bmp.ovh/imgs/2023/07/23/e724b3d3dbbd4e38.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="XYTX-荒岛"><img class="site-icon" src="https://s3.bmp.ovh/imgs/2022/04/27/7ee35760f443f634.png"/><span class="site-name">XYTX-荒岛</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 学习</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/java/"><i class="fa-fw fas fa-music"></i><span> java开发</span></a></li><li><a class="site-page child" href="/vue/"><i class="fa-fw fas fa-images"></i><span> vue学习</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li><li><a class="site-page child" href="/meitu/"><i class="fa-fw fas fa-images"></i><span> 美图</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">java爬虫</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-07-29T10:18:08.000Z" title="发表于 2023-07-29 18:18:08">2023-07-29</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-07-29T10:23:42.129Z" title="更新于 2023-07-29 18:23:42">2023-07-29</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/java/">java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">17.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>70分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="java爬虫"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="1-爬虫基础概念"><a href="#1-爬虫基础概念" class="headerlink" title="1.爬虫基础概念"></a>1.爬虫基础概念</h1><h2 id="1-1爬虫是什么"><a href="#1-1爬虫是什么" class="headerlink" title="1.1爬虫是什么"></a>1.1爬虫是什么</h2><p>  <img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B1.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<p>  <img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B2.png" alt="输入图片说明" title="QQ截图20201229183512.png"><br>  爬虫又叫网络爬虫，网络蜘蛛，一种运行在互联网上用来获取数据的的自动程序。</p>
<ul>
<li>互联网的数据，有很多，一般都是根据业务需求来的。<ul>
<li>网页（文字、图片、视频）</li>
<li>商品数据</li>
</ul>
</li>
<li>怎么获取数据？	<ul>
<li>HTTP协议</li>
<li>人的操是通过浏览器的，程序是利用网络请求的相关协议获取数据。</li>
</ul>
</li>
<li>自动化，尽可能减少人工的干预。<ul>
<li>爬虫开发的技术，没有限制的。<ul>
<li>python做网络爬虫是非常流行的。</li>
<li>Java 编写爬虫框架。</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>思考题：某公司要获取京东的数据，也要获取淘宝的数据，又要获取豆瓣上的数据，请问开发一个爬虫程序好？还是多个程序好？</p>
<h2 id="1-2-爬虫解决了什么问题"><a href="#1-2-爬虫解决了什么问题" class="headerlink" title="1.2 爬虫解决了什么问题"></a>1.2 爬虫解决了什么问题</h2><p>  <img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B3.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<h3 id="1-2-2-数据分为内部数据和外部数据"><a href="#1-2-2-数据分为内部数据和外部数据" class="headerlink" title="1.2.2 数据分为内部数据和外部数据"></a>1.2.2 数据分为内部数据和外部数据</h3><p>在互联网公司，不管内部数据还是外部数据，其实都是为了获取用户相关的数据。<br>拿到用户的行为数据之后，会分析用户。<br>比如说电商类网站就是为推荐商品，搜索类的网站为了精准营销(家具类) 广告联盟。</p>
<p><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B4.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<h4 id="1-2-2-1-公司内部数据"><a href="#1-2-2-1-公司内部数据" class="headerlink" title="1.2.2.1 公司内部数据"></a>1.2.2.1 公司内部数据</h4><p><strong>业务数据</strong>，公司使用BI（Business Intelligence）、CRM系统、ERP系统、邮件系统等产生的数据；<br><strong>财务数据</strong>，其中包括公司的支出、采购、收入等多项与公司日常运作有关的数据；<br><strong>用户数据</strong>，无论是网站、APP还是游戏，用户注册都会填写邮箱、电话、身份证号码等数据，这些数据其实非常有价值，此外还要加上用户使用公司产品留下的行为数据。<br><strong>历史数据</strong>，公司沉淀下来的其他各种数据。</p>
<h4 id="1-2-2-2-外部数据"><a href="#1-2-2-2-外部数据" class="headerlink" title="1.2.2.2 外部数据"></a>1.2.2.2 外部数据</h4><p><strong>社交网站数据</strong>，包括微信、微博、人人网、Twitter、Facebook、LinkedIn等社交媒体上的数据。<br>说明：社交数据部分是可以爬取的，另外一部分是需要运营方授权的。<br><strong>线下采集数据</strong>，包括Wifi热点数据、地图数据等。<br>说明：这一块目前做的公司比较少，但同时也比较有价值。<br><strong>政府开放数据</strong>，包括企业征信数据、企业注册数据、法院公示数据、公共交通数据等。<br>说明：如果你想要找的话，可到对应政府网站下载。<br><strong>智能设备数据</strong>，包括智能设备、传感器数据。<br>说明：你知道吗？一部智能手机，至少拥有8个传感设备。<br><strong>网络爬虫数据</strong>，包括互联网上所有可以爬回的数据，文字、视频、图片其实也是数据，而且是非结构化数据。<br><strong>企业交易数据</strong>，包括商家流水数据、支付宝交易数据、信用卡消费数据等等。<br>说明：目前这一部分数据是最难获取的，因为数据就是宝贵的资产。<br><strong>企业开放数据</strong>，比如微博开放了商业数据API，腾讯开放了腾讯云分析SDK上报的应用数据，高德地图开放了LBS数据等等。<br>说明：如果想找更多的数据API，我推荐你去数据堂、聚合数据这两家网站上看一下，上面有大量的API接口。<br><strong>其它数据</strong>，比如天气数据、交通数据、人口流动数据、位置数据等等。<br>说明：只有想不到没有弄不到。</p>
<h4 id="1-2-2-3-额外扩展"><a href="#1-2-2-3-额外扩展" class="headerlink" title="1.2.2.3 额外扩展"></a>1.2.2.3 额外扩展</h4><p>大数据就是整合完公司内部外部数据，进行大数据存储，然后通过清洗，标注、去重、去噪、关联等过程可以将数据进行结构化，也可以进行大数据挖掘和数据分析，再以数据可视化呈现结果，打通数据孤岛形成数据闭环，将数据转换成“石油”和“生产资料”，最后应用到我们日常的生活、学习和工作中去。</p>
<h2 id="1-3-爬虫与搜索系统的关系"><a href="#1-3-爬虫与搜索系统的关系" class="headerlink" title="1.3 爬虫与搜索系统的关系"></a>1.3 爬虫与搜索系统的关系</h2><p><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B5.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<p>搜索系统的数据是爬虫爬取过来？不一定。</p>
<p>搜索系统可以简单的分为两类，<code>通用搜索，站内搜索</code>。</p>
<p>通用搜索：像百度，谷歌会爬取互联网上所有的数据<br>站内搜索：只需要业务系统的数据。<br>垂直搜索：行业数据和自己的数据。</p>
<p>总结：搜索一定会包含爬虫（除站内搜索外），爬虫爬取的数据不一定是为搜索服务。除了搜索功能以外，爬虫爬取的数据主要用来做数据分析。</p>
<h2 id="1-4-爬虫的简单分类"><a href="#1-4-爬虫的简单分类" class="headerlink" title="1.4 爬虫的简单分类"></a>1.4 爬虫的简单分类</h2><p>网络爬虫按照系统结构和实现技术，大致可以分为以下几种类型：</p>
<ul>
<li>通用网络爬虫（General Purpose Web Crawler）</li>
<li>聚焦网络爬虫（Focused Web Crawler）</li>
<li>增量式网络爬虫（Incremental Web Crawler）</li>
<li>深层网络爬虫（Deep Web Crawler）<br>实际的网络爬虫系统通常是几种爬虫技术相结合实现的。</li>
</ul>
<h3 id="1-4-1通用网络爬虫"><a href="#1-4-1通用网络爬虫" class="headerlink" title="1.4.1通用网络爬虫"></a>1.4.1通用网络爬虫</h3><p>通用网络爬虫又称全网爬虫（Scalable Web Crawler），爬行对象从一些种子 URL 扩充到整个 Web，主要为门户站点搜索引擎和大型 Web 服务提供商采集数据。<br>由于商业原因，它们的技术细节很少公布出来。<br>这类网络爬虫的爬行范围和数量巨大，对于爬行速度和存储空间要求较高，对于爬行页面的顺序要求相对较低，同时由于待刷新的页面太多，通常采用并行工作方式，但需要较长时间才能刷新一次页面。 虽然存在一定缺陷，通用网络爬虫适用于为搜索引擎搜索广泛的主题，有较强的应用价值。</p>
<p><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B6.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<h3 id="1-4-2聚焦网络爬虫"><a href="#1-4-2聚焦网络爬虫" class="headerlink" title="1.4.2聚焦网络爬虫"></a>1.4.2聚焦网络爬虫</h3><p>聚焦网络爬虫（Focused Crawler），又称主题网络爬虫（Topical Crawler），是指选择性地爬行那些与预先定义好的主题相关页面的网络爬虫。<br>和通用网络爬虫相比，聚焦爬虫只需要爬行与主题相关的页面，极大地节省了硬件和网络资源，保存的页面也由于数量少而更新快，还可以很好地满足一些特定人群对特定领域信息的需求。<br><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B7.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<h2 id="1-5-爬虫的运行原理"><a href="#1-5-爬虫的运行原理" class="headerlink" title="1.5 爬虫的运行原理"></a>1.5 爬虫的运行原理</h2><p>模拟浏览器进行网络请求<br>模拟浏览器渲染（解析）html文档</p>
<p><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B8.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<h3 id="1-5-1-爬虫开发本质是HTTP请求"><a href="#1-5-1-爬虫开发本质是HTTP请求" class="headerlink" title="1.5.1 爬虫开发本质是HTTP请求"></a>1.5.1 爬虫开发本质是HTTP请求</h3><p>使用HTTP GET协议获取数据，使用HTTP POST协议提交数据。<br><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B9.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<p>客户端向服务器发送一个请求，请求头包含请求的方法、URL、协议版本、以及包含请求修饰符、客户信息和内容的类似于MIME的消息结构。</p>
<p>服务器以一个状态行作为响应，响应的内容包括消息协议的版本，成功或者错误编码加上包含服务器信息、实体元信息以及可能的实体内容。</p>
<p>通常HTTP消息包括客户机向服务器的请求消息和服务器向客户机的响应消息。这两种类型的消息由一个起始行，一个或者多个头域，一个指示头域结束的空行和可选的消息体组成。</p>
<h3 id="1-5-2-HTTP常见状态码"><a href="#1-5-2-HTTP常见状态码" class="headerlink" title="1.5.2 HTTP常见状态码"></a>1.5.2 HTTP常见状态码</h3><p> 所有的状态码:百度百科</p>
<ul>
<li>1xx:信息响应类，表示接收到请求并且继续处理</li>
<li>2xx:处理成功响应类，表示动作被成功接收、理解和接受</li>
<li>3xx:重定向响应类，为了完成指定的动作，必须接受进一步处理</li>
<li>4xx:客户端错误，客户请求包含语法错误或者是不能正确执行</li>
<li>5xx:服务端错误，服务器不能正确执行一个正确的请求</li>
</ul>
<h3 id="1-5-3-爬虫运行的原理"><a href="#1-5-3-爬虫运行的原理" class="headerlink" title="1.5.3 爬虫运行的原理"></a>1.5.3 爬虫运行的原理</h3><p><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B10.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<ul>
<li>① 指定一个种子url放入到队列中</li>
<li>② 从队列中获取某个URL</li>
<li>③ 使用HTTP协议发起网络请求</li>
<li>④ 在发起网络请求的过程中，需要将域名转化成IP地址，也就是域名解析</li>
<li>⑤ 得到服务器的响应，此时是二进制的输入流</li>
<li>⑥ 将二进制的输入流转换成HTML文档，并解析内容（我们要抓取的内容，比如标题）。</li>
<li>⑦ 将解除出来的内容保持到数据库</li>
<li>⑧ 记录当前URL，并标记为已爬取，避免下次重复爬取。</li>
<li>⑨ 从当前的HTML文档中，解析出页面中包含的其它URL，以供下次爬取</li>
<li>⑩ 判断解析出来的URL是否已经爬取过了，如果已经爬取就丢弃掉</li>
<li>⑪ 将还没爬取过的URL，存放到等待爬取的URL队列中。</li>
<li>⑫ 重复以上的步骤，指导等待爬取的URL队列中没有数据</li>
</ul>
<p>如何存储等待爬取的url？<br>如何存储已经爬取过的url？</p>
<h3 id="1-5-4-DNS域名解析了解"><a href="#1-5-4-DNS域名解析了解" class="headerlink" title="1.5.4 DNS域名解析了解"></a>1.5.4 DNS域名解析了解</h3><p>DNS（Domain Name System，域名系统），因特网上作为域名和IP地址相互映射的一个分布式数据库，能够使用户更方便的访问互联网，而不用去记住能够被机器直接读取的IP数串。<br>通过主机名，最终得到该主机名对应的IP地址的过程叫做域名解析（或主机名解析）。<br>DNS协议运行在UDP协议之上，使用端口号53。<br><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B11.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<p>更多信息请访问百度百科，DNS</p>
<p>在实际的开发过程中，我们一般会通过修改wind&#x2F;Linux 上的一个hosts文件，来改变域名指定的地址。<br>Shop.itcast.cn  127.0.0.1<br>Order.itcast.cn  127.0.0.1</p>
<h1 id="2-网络爬虫小demo"><a href="#2-网络爬虫小demo" class="headerlink" title="2.网络爬虫小demo"></a>2.网络爬虫小demo</h1><h3 id="1-2-1-爬虫是为获取数据而存在的"><a href="#1-2-1-爬虫是为获取数据而存在的" class="headerlink" title="1.2.1 爬虫是为获取数据而存在的"></a>1.2.1 爬虫是为获取数据而存在的</h3><p>一般会用来做数据分析，先通过对数据的清洗，抽取，转换，将数据做成标准化的数据，然后进行数据分析和挖掘，得到数据的商业价值。</p>
<blockquote>
<p>网络爬虫（Web crawler），是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本</p>
</blockquote>
<h2 id="2-1-第一个爬虫程序"><a href="#2-1-第一个爬虫程序" class="headerlink" title="2.1.第一个爬虫程序"></a>2.1.第一个爬虫程序</h2><h3 id="2-1-1-环境准备"><a href="#2-1-1-环境准备" class="headerlink" title="2.1.1.环境准备"></a>2.1.1.环境准备</h3><ul>
<li>JDK1.8</li>
<li>Eclipse Mars2  64位</li>
<li>Eclipse自带的Maven</li>
<li>课程资料提供的本地仓库</li>
</ul>
<h3 id="2-1-2-创建工程"><a href="#2-1-2-创建工程" class="headerlink" title="2.1.2.创建工程"></a>2.1.2.创建工程</h3><p>创建Maven工程itcast-crawler</p>
<p>  <img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typorasfsfdfdg.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<h3 id="2-1-3-加入依赖"><a href="#2-1-3-加入依赖" class="headerlink" title="2.1.3.加入依赖"></a>2.1.3.加入依赖</h3><p>给pom.xml加入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- HttpClient --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 日志 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-1-4-加入log4j-properties"><a href="#2-1-4-加入log4j-properties" class="headerlink" title="2.1.4.加入log4j.properties"></a>2.1.4.加入log4j.properties</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">log4j.rootLogger=DEBUG,A1</span></span><br><span class="line"><span class="string">log4j.logger.cn.itcast</span> <span class="string">=</span> <span class="string">DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="string">log4j.appender.A1=org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="string">log4j.appender.A1.layout=org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="string">log4j.appender.A1.layout.ConversionPattern=%-d&#123;yyyy-MM-dd</span> <span class="string">HH:mm:ss,SSS&#125;</span> [<span class="string">%t</span>] [<span class="string">%c</span>]<span class="string">-[%p]</span> <span class="string">%m%n</span></span><br></pre></td></tr></table></figure>

<h3 id="2-1-5-编写代码"><a href="#2-1-5-编写代码" class="headerlink" title="2.1.5.编写代码"></a>2.1.5.编写代码</h3><p>编写最简单的爬虫，抓取汽车之家车辆评测数据  <a target="_blank" rel="noopener" href="https://www.autohome.com.cn/bestauto/">https://www.autohome.com.cn/bestauto/</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutohomeCrawlerTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// 创建HttpClient对象</span></span><br><span class="line">		<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 声明访问地址</span></span><br><span class="line">		<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 发起请求</span></span><br><span class="line">		<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断状态码是否是200</span></span><br><span class="line">		<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">			<span class="comment">// 解析数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			System.out.println(content);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试结果，可以抓取到汽车之家的汽车评价数据</p>
<h1 id="3-网络爬虫"><a href="#3-网络爬虫" class="headerlink" title="3.网络爬虫"></a>3.网络爬虫</h1><h2 id="3-1-网络爬虫介绍"><a href="#3-1-网络爬虫介绍" class="headerlink" title="3.1.网络爬虫介绍"></a>3.1.网络爬虫介绍</h2><blockquote>
<p>在大数据时代，信息的采集是一项重要的工作，而互联网中的数据是海量的，如果单纯靠人力进行信息采集，不仅低效繁琐，搜集的成本也会提高。如何自动高效地获取互联网中我们感兴趣的信息并为我们所用是一个重要的问题，而爬虫技术就是为了解决这些问题而生的。</p>
</blockquote>
<blockquote>
<p>网络爬虫（Web crawler）也叫做网络机器人，可以代替人们自动地在互联网中进行数据信息的采集与整理。它是一种按照一定的规则，自动地抓取万维网信息的程序或者脚本，可以自动采集所有其能够访问到的页面内容，以获取或更新这些网站的内容和检索方式。</p>
</blockquote>
<blockquote>
<p>从功能上来讲，爬虫一般分为数据采集，处理，储存三个部分。爬虫从一个或若干初始网页的URL开始，获得初始网页上的URL，在抓取网页的过程中，不断从当前页面上抽取新的URL放入队列,直到满足系统的一定停止条件。</p>
</blockquote>
<h2 id="3-2-为什么学网络爬虫"><a href="#3-2-为什么学网络爬虫" class="headerlink" title="3.2.为什么学网络爬虫"></a>3.2.为什么学网络爬虫</h2><blockquote>
<p>我们初步认识了网络爬虫，但是为什么要学习网络爬虫呢？只有清晰地知道我们的学习目的，才能够更好地学习这一项知识。在此，总结了4种常见的学习爬虫的原因：</p>
</blockquote>
<ul>
<li><p>1.可以实现搜索引擎我们学会了爬虫编写之后，就可以利用爬虫自动地采集互联网中的信息，采集回来后进行相应的存储或处理，在需要检索某些信息的时候，只需在采集回来的信息中进行检索，即实现了私人的搜索引擎。</p>
</li>
<li><p>2.大数据时代，可以让我们获取更多的数据源。在进行大数据分析或者进行数据挖掘的时候，需要有数据源进行分析。我们可以从某些提供数据统计的网站获得，也可以从某些文献或内部资料中获得，但是这些获得数据的方式，有时很难满足我们对数据的需求，而手动从互联网中去寻找这些数据，则耗费的精力过大。此时就可以利用爬虫技术，自动地从互联网中获取我们感兴趣的数据内容，并将这些数据内容爬取回来，作为我们的数据源，再进行更深层次的数据分析，并获得更多有价值的信息。</p>
</li>
<li><p>3.可以更好地进行搜索引擎优化（SEO）。对于很多SEO从业者来说，为了更好的完成工作，那么就必须要对搜索引擎的工作原理非常清楚，同时也需要掌握搜索引擎爬虫的工作原理。<br>而学习爬虫，可以更深层次地理解搜索引擎爬虫的工作原理，这样在进行搜索引擎优化时，才能知己知彼，百战不殆。</p>
</li>
<li><p>4.有利于就业。从就业来说，爬虫工程师方向是不错的选择之一，因为目前爬虫工程师的需求越来越大，而能够胜任这方面岗位的人员较少，所以属于一个比较紧缺的职业方向，并且随着大数据时代和人工智能的来临，爬虫技术的应用将越来越广泛，在未来会拥有很好的发展空间。</p>
</li>
</ul>
<h1 id="4-HttpClient"><a href="#4-HttpClient" class="headerlink" title="4.HttpClient"></a>4.HttpClient</h1><blockquote>
<p>网络爬虫就是用程序帮助我们访问网络上的资源，我们一直以来都是使用HTTP协议访问互联网的网页，网络爬虫需要编写程序，在这里使用同样的HTTP协议访问网页。<br>这里我们使用Java的HTTP协议客户端 HttpClient这个技术，来实现抓取网页数据。</p>
</blockquote>
<h2 id="4-1-GET请求"><a href="#4-1-GET请求" class="headerlink" title="4.1.GET请求"></a>4.1.GET请求</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 创建HttpClient对象</span></span><br><span class="line">	<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明访问地址</span></span><br><span class="line">	<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 发起请求</span></span><br><span class="line">		response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断状态码是否是200</span></span><br><span class="line">		<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">			<span class="comment">// 解析数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			System.out.println(content.length());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 释放连接</span></span><br><span class="line">		<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				response.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			httpClient.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-带参数的GET请求"><a href="#4-2-带参数的GET请求" class="headerlink" title="4.2.带参数的GET请求"></a>4.2.带参数的GET请求</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 创建HttpClient对象</span></span><br><span class="line">	<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明访问地址</span></span><br><span class="line">	<span class="comment">// https://www.baidu.com/s?wd=汽车之家</span></span><br><span class="line">	<span class="type">URI</span> <span class="variable">uri</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URIBuilder</span>(<span class="string">&quot;https://www.baidu.com/s&quot;</span>).setParameter(<span class="string">&quot;wd&quot;</span>, <span class="string">&quot;汽车之家&quot;</span>).build();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建HttpGet请求对象</span></span><br><span class="line">	<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(uri);</span><br><span class="line"></span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 发起请求</span></span><br><span class="line">		response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断状态码是否是200</span></span><br><span class="line">		<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">			<span class="comment">// 解析数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			System.out.println(content.length());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 释放连接</span></span><br><span class="line">		<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				response.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			httpClient.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-3-POST请求"><a href="#4-3-POST请求" class="headerlink" title="4.3.POST请求"></a>4.3.POST请求</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 创建HttpClient对象</span></span><br><span class="line">	<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明访问地址</span></span><br><span class="line">	<span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;https://www.oschina.net&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置User-Agent属性，解决开源中国限制的问题</span></span><br><span class="line">	httpPost.setHeader(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 发起请求</span></span><br><span class="line">		response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断状态码是否是200</span></span><br><span class="line">		<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">			<span class="comment">// 解析数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			System.out.println(content.length());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 释放连接</span></span><br><span class="line">		<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				response.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			httpClient.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-带参数的POST请求"><a href="#4-4-带参数的POST请求" class="headerlink" title="4.4.带参数的POST请求"></a>4.4.带参数的POST请求</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 创建HttpClient对象</span></span><br><span class="line">	<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明访问地址</span></span><br><span class="line">	<span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(<span class="string">&quot;https://www.oschina.net&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置User-Agent属性，解决开源中国限制的问题</span></span><br><span class="line">	httpPost.setHeader(<span class="string">&quot;User-Agent&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置请求参数 https://www.oschina.net/search?scope=project&amp;q=HttpClient</span></span><br><span class="line">	List&lt;NameValuePair&gt; params = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;NameValuePair&gt;();</span><br><span class="line">	params.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;scope&quot;</span>, <span class="string">&quot;project&quot;</span>));</span><br><span class="line">	params.add(<span class="keyword">new</span> <span class="title class_">BasicNameValuePair</span>(<span class="string">&quot;q&quot;</span>, <span class="string">&quot;HttpClient&quot;</span>));</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 创建form表单实体</span></span><br><span class="line">	<span class="type">UrlEncodedFormEntity</span> <span class="variable">formEntity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UrlEncodedFormEntity</span>(params, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置表单到httpPost中</span></span><br><span class="line">	httpPost.setEntity(formEntity);</span><br><span class="line"></span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 发起请求</span></span><br><span class="line">		response = httpClient.execute(httpPost);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断状态码是否是200</span></span><br><span class="line">		<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">			<span class="comment">// 解析数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			System.out.println(content);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 释放连接</span></span><br><span class="line">		<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				response.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			httpClient.close();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-5-连接池"><a href="#4-5-连接池" class="headerlink" title="4.5.连接池"></a>4.5.连接池</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 创建连接池管理器</span></span><br><span class="line">	<span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">cm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 设置最大连接数</span></span><br><span class="line">	cm.setMaxTotal(<span class="number">200</span>);</span><br><span class="line">	<span class="comment">// 设置每个主机的并发数</span></span><br><span class="line">	cm.setDefaultMaxPerRoute(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">	doGet(cm);</span><br><span class="line">	doGet(cm);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(PoolingHttpClientConnectionManager cm)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 获取连接</span></span><br><span class="line">	<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom().setConnectionManager(cm).build();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明访问地址</span></span><br><span class="line">	<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 发起请求</span></span><br><span class="line">		response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断状态码是否是200</span></span><br><span class="line">		<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">			<span class="comment">// 解析数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			System.out.println(content.length());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 释放连接</span></span><br><span class="line">		<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				response.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">// 不能关闭HttpClient</span></span><br><span class="line">			<span class="comment">// httpClient.close();</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-6-请求参数"><a href="#4-6-请求参数" class="headerlink" title="4.6.请求参数"></a>4.6.请求参数</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">	<span class="comment">// 创建HttpClient对象</span></span><br><span class="line">	<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 声明访问地址</span></span><br><span class="line">	<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 构建请求配置信息</span></span><br><span class="line">	<span class="type">RequestConfig</span> <span class="variable">config</span> <span class="operator">=</span> RequestConfig.custom().setConnectTimeout(<span class="number">1000</span>) <span class="comment">// 创建连接的最长时间</span></span><br><span class="line">			.setConnectionRequestTimeout(<span class="number">500</span>) <span class="comment">// 从连接池中获取到连接的最长时间</span></span><br><span class="line">			.setSocketTimeout(<span class="number">10</span> * <span class="number">1000</span>) <span class="comment">// 数据传输的最长时间</span></span><br><span class="line">			.build();</span><br><span class="line">	<span class="comment">// 设置请求配置信息</span></span><br><span class="line">	httpGet.setConfig(config);</span><br><span class="line"></span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 发起请求</span></span><br><span class="line">		response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 判断状态码是否是200</span></span><br><span class="line">		<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">			<span class="comment">// 解析数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">			System.out.println(content.length());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 释放连接</span></span><br><span class="line">		<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				response.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-Jsoup"><a href="#5-Jsoup" class="headerlink" title="5.Jsoup"></a>5.Jsoup</h1><blockquote>
<p>我们抓取到页面之后，还需要对页面进行解析。可以使用字符串处理工具解析页面，也可以使用正则表达式，但是这些方法都会带来很大的开发成本，所以我们需要使用一款专门解析html页面的技术。</p>
</blockquote>
<blockquote>
<p>这里我们使用jsoup来解析页面</p>
</blockquote>
<h2 id="5-1-jsoup介绍"><a href="#5-1-jsoup介绍" class="headerlink" title="5.1.jsoup介绍"></a>5.1.jsoup介绍</h2><blockquote>
<p>jsoup 是一款Java 的HTML解析器，可直接解析某个URL地址、HTML文本内容。它提供了一套非常省力的API，可通过DOM，CSS以及类似于jQuery的操作方法来取出和操作数据。</p>
</blockquote>
<p>jsoup的主要功能如下：</p>
<ul>
<li>1.从一个URL，文件或字符串中解析HTML；</li>
<li>2.使用DOM或CSS选择器来查找、取出数据；</li>
<li>3.可操作HTML元素、属性、文本；</li>
</ul>
<p>先加入Jsoup依赖：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">		<span class="comment">&lt;!-- jsoup --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>	</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 加入处理文字和处理文件的工具类依赖：--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 工具类 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="5-2-jsoup输入"><a href="#5-2-jsoup输入" class="headerlink" title="5.2.jsoup输入"></a>5.2.jsoup输入</h2><h4 id="5-2-1-输入url"><a href="#5-2-1-输入url" class="headerlink" title="5.2.1.输入url"></a>5.2.1.输入url</h4><p>Jsoup可以直接输入url，它会发起请求并获取数据，封装为Document对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 使用jsoup解析url</span></span><br><span class="line">	<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">URL</span>(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>), <span class="number">10000</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 把获取的内容输出为文件</span></span><br><span class="line">	FileUtils.writeStringToFile(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/test.html&quot;</span>), doc.toString(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取title</span></span><br><span class="line">	<span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> doc.getElementsByTag(<span class="string">&quot;title&quot;</span>).first();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 打印title内容</span></span><br><span class="line">	System.out.println(element.text());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>PS：虽然使用Jsoup可以替代HttpClient直接发起请求解析数据，但是往往不会这样用，因为实际的开发过程中，需要使用到多线程，连接池，代理等等技术，而jsoup对这些技术的支持并不是很好，所以jsoup一般仅仅作为Html解析工具使用</p>
<h3 id="5-2-2-输入字符串"><a href="#5-2-2-输入字符串" class="headerlink" title="5.2.2.输入字符串"></a>5.2.2.输入字符串</h3><p>Jsoup可以直接输入字符串，并封装为Document对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 读取文件，获取字符串</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> FileUtils.readFileToString(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/test.html&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 解析字符串</span></span><br><span class="line">	<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取title标签</span></span><br><span class="line">	<span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> doc.getElementsByTag(<span class="string">&quot;title&quot;</span>).first();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打印title内容</span></span><br><span class="line">	System.out.println(element.text());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-3-输入文件"><a href="#5-2-3-输入文件" class="headerlink" title="5.2.3.输入文件"></a>5.2.3.输入文件</h3><p>Jsoup可以直接输入文件，并封装为Document对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// 使用jsoup解析文件</span></span><br><span class="line">	<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/test.html&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 获取title标签</span></span><br><span class="line">	<span class="type">Element</span> <span class="variable">element</span> <span class="operator">=</span> doc.getElementsByTag(<span class="string">&quot;title&quot;</span>).first();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 打印title内容</span></span><br><span class="line">	System.out.println(element.text());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-3-Jsoup解析"><a href="#5-3-Jsoup解析" class="headerlink" title="5.3.Jsoup解析"></a>5.3.Jsoup解析</h2><h3 id="5-3-1-使用dom方式遍历文档"><a href="#5-3-1-使用dom方式遍历文档" class="headerlink" title="5.3.1.使用dom方式遍历文档"></a>5.3.1.使用dom方式遍历文档</h3><p>对象集合</p>
<ul>
<li>all[] 提供对文档中所有 HTML 元素的访问。</li>
<li>anchors[] 返回对文档中所有 Anchor 对象的引用。</li>
<li>applets 返回对文档中所有 Applet 对象的引用。</li>
<li>forms[] 返回对文档中所有 Form 对象引用。</li>
<li>images[] 返回对文档中所有 Image 对象引用。</li>
<li>links[] 返回对文档中所有 Area 和 Link 对象引用。</li>
</ul>
<p>对象属性</p>
<ul>
<li>body 提供对 元素的直接访问。 对于定义了框架集的文档，该属性引用最外层的 。</li>
<li>cookie 设置或返回与当前文档有关的所有 cookie。</li>
<li>domain 返回当前文档的域名。</li>
<li>lastModified 返回文档被最后修改的日期和时间。</li>
<li>referrer 返回载入当前文档的文档的 URL。</li>
<li>title 返回当前文档的标题。</li>
<li>URL 返回当前文档的 URL。</li>
</ul>
<p>元素获取</p>
<ul>
<li>1.根据id查询元素getElementById</li>
<li>2.根据标签获取元素getElementsByTag</li>
<li>3.根据class获取元素getElementsByClass</li>
<li>4.根据属性获取元素getElementsByAttribute</li>
<li>5.getElementsByName() 返回带有指定名称的对象集合。</li>
<li>6.close() 关闭用 document.open() 方法打开的输出流，并显示选定的数据。</li>
<li>7.getElementsByTagName() 返回带有指定标签名的对象集合。</li>
<li>8.open() 打开一个流，以收集来自任何 document.write() 或 document.writeln() 方法的输出。</li>
<li>9.write() 向文档写 HTML 表达式 或 JavaScript 代码。</li>
<li>10.writeln() 等同于 write() 方法，不同的是在每个表达式之后写一个换行符。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 根据id查询元素getElementById</span></span><br><span class="line">str = doc.getElementById(<span class="string">&quot;auto-header-fenzhan&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 根据标签获取元素getElementsByTag</span></span><br><span class="line">str = doc.getElementsByTag(<span class="string">&quot;li&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 根据class获取元素getElementsByClass</span></span><br><span class="line">str = doc.getElementsByClass(<span class="string">&quot;mini-main&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 根据属性获取元素getElementsByAttribute</span></span><br><span class="line">str = doc.getElementsByAttribute(<span class="string">&quot;abc&quot;</span>).first().text();</span><br><span class="line">str = doc.getElementsByAttributeValue(<span class="string">&quot;abc&quot;</span>, <span class="string">&quot;123&quot;</span>).first().text();</span><br></pre></td></tr></table></figure>

<p>元数据获取</p>
<ul>
<li>1.从元素中获取id</li>
<li>2.从元素中获取className和classNames</li>
<li>3.从元素中获取属性的值attr</li>
<li>4.从元素中获取所有属性attributes</li>
<li>5.从元素中获取文本内容text</li>
<li>6.从获取元素中的html</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 元数据操作</span></span><br><span class="line"><span class="type">Element</span> <span class="variable">e</span> <span class="operator">=</span> doc.getElementsByTag(<span class="string">&quot;a&quot;</span>).first();</span><br><span class="line"><span class="comment">// 1. 从元素中获取id</span></span><br><span class="line">str = e.id();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 从元素中获取className和classNames</span></span><br><span class="line">str = e.className();</span><br><span class="line"><span class="keyword">for</span> (String s : e.classNames()) &#123;</span><br><span class="line">	System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 从元素中获取属性的值attr</span></span><br><span class="line">str = e.attr(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 从元素中获取所有属性attributes</span></span><br><span class="line">str = e.attributes().toString();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 从元素中获取文本内容text</span></span><br><span class="line">str = e.text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. 从获取元素中的html</span></span><br><span class="line">str = e.html();</span><br></pre></td></tr></table></figure>

<h3 id="5-3-2-使用选择器语法查找元素"><a href="#5-3-2-使用选择器语法查找元素" class="headerlink" title="5.3.2.使用选择器语法查找元素"></a>5.3.2.使用选择器语法查找元素</h3><p>jsoup elements对象支持类似于CSS (或jquery)的选择器语法，来实现非常强大和灵活的查找功能。这个select 方法在Document, Element,或Elements对象中都可以使用。且是上下文相关的，因此可实现指定元素的过滤，或者链式选择访问。</p>
<p>Select方法将返回一个Elements集合，并提供一组方法来抽取和处理结果。</p>
<h3 id="5-3-3-Selector选择器概述"><a href="#5-3-3-Selector选择器概述" class="headerlink" title="5.3.3.Selector选择器概述"></a>5.3.3.Selector选择器概述</h3><ul>
<li><p>tagname: 通过标签查找元素，比如：a</p>
</li>
<li><p>ns|tag: 通过标签在命名空间查找元素，比如：可以用 fb|name 语法来查找 <a href="fb:name">fb:name</a> 元素</p>
</li>
<li><p>#id: 通过ID查找元素，比如：#logo</p>
</li>
<li><p>.class: 通过class名称查找元素，比如：.masthead</p>
</li>
<li></li>
<li></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用选择器</span></span><br><span class="line"><span class="comment">// tagname: 通过标签查找元素，比如：a</span></span><br><span class="line">str = doc.select(<span class="string">&quot;a&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ns|tag: 通过标签在命名空间查找元素，比如：可以用 fb|name 语法来查找 &lt;fb:name&gt; 元素</span></span><br><span class="line">str = doc.select(<span class="string">&quot;jsoup|li&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// #id: 通过ID查找元素，比如：#logo</span></span><br><span class="line">str = doc.select(<span class="string">&quot;#auto-header-fenzhan&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// .class: 通过class名称查找元素，比如：.masthead</span></span><br><span class="line">str = doc.select(<span class="string">&quot;.orangelink&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [attribute]: 利用属性查找元素，比如：[href]</span></span><br><span class="line">str = doc.select(<span class="string">&quot;[abc]&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// [attr=value]: 利用属性值来查找元素，比如：[width=500]</span></span><br><span class="line">str = doc.select(<span class="string">&quot;[class=vlli]&quot;</span>).first().text();</span><br></pre></td></tr></table></figure>

<h4 id="5-3-3-1-Selector选择器组合使用"><a href="#5-3-3-1-Selector选择器组合使用" class="headerlink" title="5.3.3.1.Selector选择器组合使用"></a>5.3.3.1.Selector选择器组合使用</h4><ul>
<li>el#id: 元素+ID，比如： div#logo</li>
<li>el.class: 元素+class，比如： div.masthead</li>
<li>el[attr]: 元素+属性名，比如： a[href]</li>
<li>任意组合，比如：a[href].highlight</li>
<li>ancestor child: 查找某个元素下子元素，比如：.body p 查找”body”下的所有 p</li>
<li>parent &gt; child: 查找某个父元素下的直接子元素，比如：div.content &gt; p 查找 p</li>
<li>parent &gt; * 查找某个父元素下所有直接子元素</li>
<li>siblingA + siblingB: 查找在A元素之前第一个同级元素B，比如：div.head + div</li>
<li>siblingA ~ siblingX: 查找A元素之前的同级X元素，比如：h1 ~ p</li>
<li>:lt(n): 查找哪些元素的同级索引值（它的位置在DOM树中是相对于它的父节点）小于n，比如：td:lt(3) 表示小于三列的元素</li>
<li>:gt(n):查找哪些元素的同级索引值大于n，比如： div p:gt(2)表示哪些div中有包含2个以上的p元素</li>
<li>:eq(n): 查找哪些元素的同级索引值与n相等，比如：form input:eq(1)表示包含一个input标签的Form元素</li>
<li>:has(seletor): 查找匹配选择器包含元素的元素，比如：div:has(p)表示哪些div包含了p元素</li>
<li>:not(selector): 查找与选择器不匹配的元素，比如： div:not(.logo) 表示不包含 class&#x3D;logo 元素的所有 div 列表</li>
<li>:contains(text): 查找包含给定文本的元素，搜索不区分大不写，比如： p:contains(jsoup)</li>
<li>:containsOwn(text): 查找直接包含给定文本的元素</li>
<li>:matches(regex): 查找哪些元素的文本匹配指定的正则表达式，比如：div:matches((?i)login)</li>
<li>:matchesOwn(regex): 查找自身包含文本匹配指定正则表达式的元素</li>
<li>注意：上述伪选择器索引是从0开始的，也就是说第一个元素索引值为0，第二个元素index为1等</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组合选择器</span></span><br><span class="line"><span class="comment">// el#id: 元素+ID，比如： div#logo</span></span><br><span class="line">str = doc.select(<span class="string">&quot;li#auto-header-fenzhan&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// el.class: 元素+class，比如： div.masthead</span></span><br><span class="line">str = doc.select(<span class="string">&quot;a.greylink&quot;</span>).first().text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// el[attr]: 元素+属性，比如： a[href]</span></span><br><span class="line">str = doc.select(<span class="string">&quot;a[href]&quot;</span>).first().attr(<span class="string">&quot;href&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 任意组合，比如：a[href].highlight</span></span><br><span class="line">str = doc.select(<span class="string">&quot;a[href].greylink&quot;</span>).first().attr(<span class="string">&quot;href&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ancestor child: 查找某个元素下子元素，比如：可以用.body p 查找&quot;body&quot;下的所有 p</span></span><br><span class="line">str = doc.select(<span class="string">&quot;div.mini-left a&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// parent &gt; child: 查找某个父元素下的直接子元素，比如：div.content &gt; p 查找 p</span></span><br><span class="line">str = doc.select(<span class="string">&quot;div.mini-left ul &gt; li&quot;</span>).text();</span><br><span class="line"></span><br><span class="line"><span class="comment">// parent &gt; * 查找某个父元素下所有直接子元素</span></span><br><span class="line"><span class="type">Elements</span> <span class="variable">elements</span> <span class="operator">=</span> doc.select(<span class="string">&quot;div.mini-left &gt; *&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (Element ele : elements) &#123;</span><br><span class="line">	System.out.println(ele.tagName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="6-爬虫分类"><a href="#6-爬虫分类" class="headerlink" title="6.爬虫分类"></a>6.爬虫分类</h1><p>网络爬虫按照系统结构和实现技术，大致可以分为以下几种类型：通用网络爬虫、聚焦网络爬虫、增量式网络爬虫、深层网络爬虫。 实际的网络爬虫系统通常是几种爬虫技术相结合实现的</p>
<h2 id="6-1-通用网络爬虫"><a href="#6-1-通用网络爬虫" class="headerlink" title="6.1.通用网络爬虫"></a>6.1.通用网络爬虫</h2><p>通用网络爬虫又称全网爬虫（Scalable Web Crawler），爬行对象从一些种子 URL 扩充到整个 Web，主要为门户站点搜索引擎和大型 Web 服务提供商采集数据。<br>这类网络爬虫的爬行范围和数量巨大，对于爬行速度和存储空间要求较高，对于爬行页面的顺序要求相对较低，同时由于待刷新的页面太多，通常采用并行工作方式，但需要较长时间才能刷新一次页面。<br>简单的说就是互联网上抓取所有数据。</p>
<h2 id="6-2-聚焦网络爬虫"><a href="#6-2-聚焦网络爬虫" class="headerlink" title="6.2.聚焦网络爬虫"></a>6.2.聚焦网络爬虫</h2><p>聚焦网络爬虫（Focused Crawler），又称主题网络爬虫（Topical Crawler），是指选择性地爬行那些与预先定义好的主题相关页面的网络爬虫。<br>和通用网络爬虫相比，聚焦爬虫只需要爬行与主题相关的页面，极大地节省了硬件和网络资源，保存的页面也由于数量少而更新快，还可以很好地满足一些特定人群对特定领域信息的需求 。<br>简单的说就是互联网上只抓取某一种数据。</p>
<h2 id="6-3-增量式网络爬虫"><a href="#6-3-增量式网络爬虫" class="headerlink" title="6.3.增量式网络爬虫"></a>6.3.增量式网络爬虫</h2><p>增量式网络爬虫（Incremental Web Crawler）是 指 对 已 下 载 网 页 采 取 增量式更新和只爬行新产生的或者已经发生变化网页的爬虫，它能够在一定程度上保证所爬行的页面是尽可能新的页面。<br>和周期性爬行和刷新页面的网络爬虫相比，增量式爬虫只会在需要的时候爬行新产生或发生更新的页面 ，并不重新下载没有发生变化的页面，可有效减少数据下载量，及时更新已爬行的网页，减小时间和空间上的耗费，但是增加了爬行算法的复杂度和实现难度。<br>简单的说就是互联网上只抓取刚刚更新的数据。</p>
<h2 id="6-4-Deep-Web-爬虫"><a href="#6-4-Deep-Web-爬虫" class="headerlink" title="6.4.Deep Web 爬虫"></a>6.4.Deep Web 爬虫</h2><p>Web 页面按存在方式可以分为表层网页（Surface Web）和深层网页（Deep Web，也称 Invisible Web Pages 或 Hidden Web）。<br>表层网页是指传统搜索引擎可以索引的页面，以超链接可以到达的静态网页为主构成的 Web 页面。<br>Deep Web 是那些大部分内容不能通过静态链接获取的、隐藏在搜索表单后的，只有用户提交一些关键词才能获得的 Web 页面。</p>
<h1 id="7-案例需求"><a href="#7-案例需求" class="headerlink" title="7.案例需求"></a>7.案例需求</h1><p>前面介绍了几种爬虫的分类，这里我们使用聚焦网络爬虫，抓取汽车之家上的汽车评测数据。<a target="_blank" rel="noopener" href="https://www.autohome.com.cn/bestauto/">https://www.autohome.com.cn/bestauto/</a></p>
<p>  <img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora353253.png" alt="输入图片说明" title="QQ截图20201229183512.png"><br>我们需要抓取汽车之家上面所有的汽车评测数据</p>
<p>需求分析</p>
<p>在页面上我们分析，需要抓取以下部分的数据<br>  <img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora6616.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<ul>
<li>1.车型信息</li>
</ul>
<p><code>品牌 车型 款式</code></p>
<p><code>吉利汽车 远景X3 2017款 1.5L 手动尊贵型</code></p>
<ul>
<li>2.评测信息<br>测试项目  测试结果</li>
</ul>
<p><code>加速(0-100公里/小时)		13.65秒</code></p>
<p><code>刹车(100-0公里/小时)		39.50米</code></p>
<p><code>实测油耗(升/100公里)		7.7升</code></p>
<p>排名是动态生成的，我们这里不做抓取，可以后期单独处理排名</p>
<ul>
<li>3.编辑点评</li>
</ul>
<p><code>评测编辑		编辑点评</code></p>
<p><code>于晗 		它和远景X1有不同的风格。。。</code></p>
<p><code>周宇轩 	除了动力弱点儿。。。</code></p>
<p><code>李坤 		我比较喜欢它的内外饰设计。。。</code></p>
<ul>
<li>4.评测图片</li>
</ul>
<p><code>有5张图片，页面显示的是小图，我们需要打开超链接获取大图的url地址，再单独下载图片</code></p>
<h1 id="8-环境准备"><a href="#8-环境准备" class="headerlink" title="8.环境准备"></a>8.环境准备</h1><p>使用技术：<br>jdk8+SpringBoot1.5.8+SpringMVC4+MyBatis3.4+HttpClient4.5.3+Jsoup2.10+Quartz2.2</p>
<h2 id="8-1-搭建工程"><a href="#8-1-搭建工程" class="headerlink" title="8.1.搭建工程"></a>8.1.搭建工程</h2><p>创建Maven工程</p>
<p>工程需要继承SpringBoot的parent</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-1-1-加入依赖"><a href="#8-1-1-加入依赖" class="headerlink" title="8.1.1.加入依赖"></a>8.1.1.加入依赖</h3><p>设置jdk为1.8，并加入相关依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- spring相关包 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 配置测试启动器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- MyBatis启动器 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- MySQL连接驱动 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 工具类 --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 定时任务Quartz --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- HttpClient --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.httpcomponents<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>httpclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- jsoup --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jsoup<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsoup<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="8-1-2-加入配置"><a href="#8-1-2-加入配置" class="headerlink" title="8.1.2.加入配置"></a>8.1.2.加入配置</h3><p>在src&#x2F;main&#x2F;resources路径下加入以下两个配置文件</p>
<p>加入application.properties</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#日志</span></span><br><span class="line"><span class="string">logging.level.org.mybatis=DEBUG</span></span><br><span class="line"><span class="string">logging.level.cn.itcast=DEBUG</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#DBConfiguration:</span></span><br><span class="line"><span class="string">spring.datasource.driverClassName=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="string">spring.datasource.url=jdbc:mysql://127.0.0.1:3306/crawler?useUnicode=true&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="string">spring.datasource.username=root</span></span><br><span class="line"><span class="string">spring.datasource.password=root</span></span><br></pre></td></tr></table></figure>

<h2 id="8-2-SpringBoot入门"><a href="#8-2-SpringBoot入门" class="headerlink" title="8.2.SpringBoot入门"></a>8.2.SpringBoot入门</h2><p>项目使用的是SpringBoot+ssm框架，这里先实现入门程序，用以熟悉SpringBoot的使用。<br>需求：浏览器访问，获取数据库时间</p>
<h3 id="8-2-1-编写引导类"><a href="#8-2-1-编写引导类" class="headerlink" title="8.2.1.编写引导类"></a>8.2.1.编写引导类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">		SpringApplication.run(Application.class, args);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-2-编写Mapper"><a href="#8-2-2-编写Mapper" class="headerlink" title="8.2.2.编写Mapper"></a>8.2.2.编写Mapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TestMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询数据库时间</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Select(&quot;SELECT NOW()&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">queryDate</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-3-编写Service接口"><a href="#8-2-3-编写Service接口" class="headerlink" title="8.2.3.编写Service接口"></a>8.2.3.编写Service接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询数据库时间</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">queryDate</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-4-编写Service实现"><a href="#8-2-4-编写Service实现" class="headerlink" title="8.2.4.编写Service实现"></a>8.2.4.编写Service实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">TestService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TestMapper testMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">queryDate</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> <span class="built_in">this</span>.testMapper.queryDate();</span><br><span class="line">		<span class="keyword">return</span> date;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-2-5-编写Controller"><a href="#8-2-5-编写Controller" class="headerlink" title="8.2.5.编写Controller"></a>8.2.5.编写Controller</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TestService testService;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// http://127.0.0.1:8080/date</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 查询数据库时间</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@RequestMapping(&quot;date&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">queryDate</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">date</span> <span class="operator">=</span> <span class="built_in">this</span>.testService.queryDate();</span><br><span class="line">		<span class="keyword">return</span> date;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="9-开发分析"><a href="#9-开发分析" class="headerlink" title="9.开发分析"></a>9.开发分析</h1><h2 id="9-1-流程分析"><a href="#9-1-流程分析" class="headerlink" title="9.1.流程分析"></a>9.1.流程分析</h2><p>分析发现，评测页的url是<br><a target="_blank" rel="noopener" href="https://www.autohome.com.cn/bestauto/1">https://www.autohome.com.cn/bestauto/1</a><br>最后一个参数是页码数，我们只需要按顺序从第一页开始，把所有的页面都抓取下来就可以了。</p>
<p>抓取页面的流程如下</p>
<p>抓取评测数据：</p>
<ul>
<li>1.根据url抓取html页面</li>
<li>2.对html页面进行解析，获取该页面所有的评测数据</li>
<li>3.遍历所有的评测数据</li>
<li>4.判断遍历的评测数据是否已保存，<ul>
<li>如果已保存再次遍历下一条评测数据</li>
<li>如果未保存执行下一步</li>
</ul>
</li>
<li>5.保存评测数据到数据库中</li>
</ul>
<h2 id="9-2-数据库表设计"><a href="#9-2-数据库表设计" class="headerlink" title="9.2.数据库表设计"></a>9.2.数据库表设计</h2><p>根据以上需求，设计数据库表。sql如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `car_test` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="string">&#x27;主键id&#x27;</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测车辆的名字&#x27;</span>,</span><br><span class="line">  `test_speed` <span class="type">int</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测项目-加速(0-100公里/小时),单位毫秒&#x27;</span>,</span><br><span class="line">  `test_brake` <span class="type">int</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测项目-刹车(100-0公里/小时),单位毫米&#x27;</span>,</span><br><span class="line">  `test_oil` <span class="type">int</span>(<span class="number">150</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测项目-实测油耗(升/100公里)，单位毫升&#x27;</span>,</span><br><span class="line">  `editor_name1` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测编辑1&#x27;</span>,</span><br><span class="line">  `editor_remark1` <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;点评内容1&#x27;</span>,</span><br><span class="line">  `editor_name2` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测编辑2&#x27;</span>,</span><br><span class="line">  `editor_remark2` <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;点评内容2&#x27;</span>,</span><br><span class="line">  `editor_name3` <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测编辑3&#x27;</span>,</span><br><span class="line">  `editor_remark3` <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;点评内容3&#x27;</span>,</span><br><span class="line">  `image` <span class="type">varchar</span>(<span class="number">1000</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;评测图片，5张图片名，中间用,分隔&#x27;</span>,</span><br><span class="line">  `created` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;创建时间&#x27;</span>,</span><br><span class="line">  `updated` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;更新时间&#x27;</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">7</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8 COMMENT<span class="operator">=</span><span class="string">&#x27;汽车之家评测表&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="9-3-开发准备"><a href="#9-3-开发准备" class="headerlink" title="9.3.开发准备"></a>9.3.开发准备</h2><p>编写Pojo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> Long id;</span><br><span class="line">	<span class="keyword">private</span> String title;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> test_speed;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> test_brake;</span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> test_oil; </span><br><span class="line">	<span class="keyword">private</span> String editor_name1;</span><br><span class="line">	<span class="keyword">private</span> String editor_remark1;</span><br><span class="line">	<span class="keyword">private</span> String editor_name2;</span><br><span class="line">	<span class="keyword">private</span> String editor_remark2; </span><br><span class="line">	<span class="keyword">private</span> String editor_name3;</span><br><span class="line">	<span class="keyword">private</span> String editor_remark3;</span><br><span class="line">	<span class="keyword">private</span> String image;</span><br><span class="line">	<span class="keyword">private</span> Date created;</span><br><span class="line">	<span class="keyword">private</span> Date updated;</span><br><span class="line">        <span class="comment">// get/set。。。 省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写Mapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarTestMapper</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写Service接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarTestService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写Service接口实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarTestServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CarTestService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="10-实现爬取数据"><a href="#10-实现爬取数据" class="headerlink" title="10.实现爬取数据"></a>10.实现爬取数据</h1><h2 id="10-1-实现ApiService"><a href="#10-1-实现ApiService" class="headerlink" title="10.1.实现ApiService"></a>10.1.实现ApiService</h2><p>首先需要编写用来抓取页面的ApiService。</p>
<h3 id="10-1-1-编写连接池管理器"><a href="#10-1-1-编写连接池管理器" class="headerlink" title="10.1.1.编写连接池管理器"></a>10.1.1.编写连接池管理器</h3><p>这里使用连接池管理，而连接池管理器应该交给Spring进行管理，我们这里使用以下两个注解</p>
<ul>
<li>@Configuration注解声明配置类。</li>
<li>@Bean注解声明如何创建这实例</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpClientCMCfg</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> PoolingHttpClientConnectionManager <span class="title function_">poolingHttpClientConnectionManager</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 创建连接管理器</span></span><br><span class="line">		<span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">cm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置最大连接数</span></span><br><span class="line">		cm.setMaxTotal(<span class="number">200</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置每个并发连接数</span></span><br><span class="line">		cm.setDefaultMaxPerRoute(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> cm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-1-2-定时关闭失效连接"><a href="#10-1-2-定时关闭失效连接" class="headerlink" title="10.1.2.定时关闭失效连接"></a>10.1.2.定时关闭失效连接</h3><p>这里使用Quartz定时任务来处理定时关闭失效连接</p>
<h4 id="10-1-2-1-编写定时任务"><a href="#10-1-2-1-编写定时任务" class="headerlink" title="10.1.2.1.编写定时任务"></a>10.1.2.1.编写定时任务</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步执行任务(单线程)</span></span><br><span class="line"><span class="meta">@DisallowConcurrentExecution</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CloseConnectJob</span> <span class="keyword">extends</span> <span class="title class_">QuartzJobBean</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException &#123;</span><br><span class="line">		<span class="comment">// 获取spring容器</span></span><br><span class="line">		<span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) context.getJobDetail().getJobDataMap()</span><br><span class="line">				.get(<span class="string">&quot;context&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 从容器中获取HttpClient连接管理器</span></span><br><span class="line">		<span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">cm</span> <span class="operator">=</span> applicationContext.getBean(PoolingHttpClientConnectionManager.class);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 关闭失效连接</span></span><br><span class="line">		cm.closeExpiredConnections();</span><br><span class="line">		System.out.println(<span class="string">&quot;关闭失效连接&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10-1-2-2-定时执行任务"><a href="#10-1-2-2-定时执行任务" class="headerlink" title="10.1.2.2.定时执行任务"></a>10.1.2.2.定时执行任务</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SchedledCfg</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义关闭无效连接任务</span></span><br><span class="line">	<span class="meta">@Bean(&quot;closeConnectJobBean&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> JobDetailFactoryBean <span class="title function_">closeConnectJobBean</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">JobDetailFactoryBean</span> <span class="variable">jobDetailFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JobDetailFactoryBean</span>();</span><br><span class="line">		jobDetailFactoryBean.setApplicationContextJobDataKey(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">		jobDetailFactoryBean.setJobClass(CloseConnectJob.class);</span><br><span class="line">		jobDetailFactoryBean.setDurability(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> jobDetailFactoryBean;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义关闭无效连接触发器</span></span><br><span class="line">	<span class="meta">@Bean(&quot;closeConnectJobTrigger&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> CronTriggerFactoryBean <span class="title function_">closeConnectJobTrigger</span><span class="params">(</span></span><br><span class="line"><span class="params">			<span class="meta">@Qualifier(value = &quot;closeConnectJobBean&quot;)</span> JobDetailFactoryBean itemJobBean)</span> &#123;</span><br><span class="line">		<span class="type">CronTriggerFactoryBean</span> <span class="variable">tigger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CronTriggerFactoryBean</span>();</span><br><span class="line">		tigger.setJobDetail(itemJobBean.getObject());</span><br><span class="line">		tigger.setCronExpression(<span class="string">&quot;0/5 * * * * ? &quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> tigger;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义调度器</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> SchedulerFactoryBean <span class="title function_">schedulerFactory</span><span class="params">(CronTrigger[] cronTriggerImpl)</span> &#123;</span><br><span class="line">		<span class="type">SchedulerFactoryBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchedulerFactoryBean</span>();</span><br><span class="line">		bean.setTriggers(cronTriggerImpl);</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-1-3-编写ApiService接口"><a href="#10-1-3-编写ApiService接口" class="headerlink" title="10.1.3.编写ApiService接口"></a>10.1.3.编写ApiService接口</h3><p>需要实现两个功能的下载：</p>
<ul>
<li>1.Get请求获取页面数据</li>
<li>2.Get请求下载图片</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 使用get请求获取页面数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getHtml</span><span class="params">(String url)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 使用get请求下载图片,返回图片名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> url</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getImage</span><span class="params">(String url)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-1-4-实现ApiService接口"><a href="#10-1-4-实现ApiService接口" class="headerlink" title="10.1.4.实现ApiService接口"></a>10.1.4.实现ApiService接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">ApiService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> PoolingHttpClientConnectionManager cm;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getHtml</span><span class="params">(String url)</span> &#123;</span><br><span class="line">		<span class="comment">// 使用连接池管理器获取连接</span></span><br><span class="line">		<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom().setConnectionManager(cm).build();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建httpGet请求</span></span><br><span class="line">		<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line"></span><br><span class="line">		<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 发起请求</span></span><br><span class="line">			response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 判断请求是否成功</span></span><br><span class="line">			<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">				<span class="comment">// 判断是否有响应体</span></span><br><span class="line">				<span class="keyword">if</span> (response.getEntity() != <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="comment">// 如果有响应体，则进行解析</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> EntityUtils.toString(response.getEntity(), <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 返回</span></span><br><span class="line">					<span class="keyword">return</span> html;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 释放连接</span></span><br><span class="line">			<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					response.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">getImage</span><span class="params">(String url)</span> &#123;</span><br><span class="line">		<span class="comment">// 使用连接池管理器获取连接</span></span><br><span class="line">		<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom().setConnectionManager(cm).build();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建httpGet请求</span></span><br><span class="line">		<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line"></span><br><span class="line">		<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 发起请求</span></span><br><span class="line">			response = httpClient.execute(httpGet);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 判断请求是否成功</span></span><br><span class="line">			<span class="keyword">if</span> (response.getStatusLine().getStatusCode() == <span class="number">200</span>) &#123;</span><br><span class="line">				<span class="comment">// 判断是否有响应体</span></span><br><span class="line">				<span class="keyword">if</span> (response.getEntity() != <span class="literal">null</span>) &#123;</span><br><span class="line">					<span class="comment">// 如果有响应体，则下载</span></span><br><span class="line">					<span class="comment">// 获取文件后缀</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">extName</span> <span class="operator">=</span> StringUtils.substringAfterLast(url, <span class="string">&quot;.&quot;</span>);</span><br><span class="line">					<span class="comment">// 用UUID重新生成文件名</span></span><br><span class="line">					<span class="type">String</span> <span class="variable">image</span> <span class="operator">=</span> UUID.randomUUID().toString() + <span class="string">&quot;.&quot;</span> + extName;</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 下载图片</span></span><br><span class="line">					<span class="type">OutputStream</span> <span class="variable">outstream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/images/&quot;</span> + image));</span><br><span class="line">					response.getEntity().writeTo(outstream);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// 返回图片名</span></span><br><span class="line">					<span class="keyword">return</span> image;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">			<span class="comment">// 释放连接</span></span><br><span class="line">			<span class="keyword">if</span> (response != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="keyword">try</span> &#123;</span><br><span class="line">					response.close();</span><br><span class="line">				&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">					e.printStackTrace();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="10-1-5-测试ApiService接口"><a href="#10-1-5-测试ApiService接口" class="headerlink" title="10.1.5.测试ApiService接口"></a>10.1.5.测试ApiService接口</h3><p>这里使用SpringBoot的测试组件，需要添加如下两个注解：</p>
<p>@RunWith(value &#x3D; SpringJUnit4ClassRunner.class)<br>让测试运行在spring的环境，这样我们测试的时候就可以和开发的时候一样编写代码，例如使用@Autowired注解直接注入</p>
<p>@SpringBootTest(classes &#x3D; Application.class)<br>执行当前的这个类是测试类</p>
<p>测试代码如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(value = SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiServiceTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ApiService apiService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetHtml</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="built_in">this</span>.apiService.getHtml(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span>);</span><br><span class="line">		System.out.println(html);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetImage</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="built_in">this</span>.apiService.getImage(</span><br><span class="line">				<span class="string">&quot;https://car2.autoimg.cn/cardfs/product/g24/M09/AE/EB/800x0_1_q87_autohomecar__wKgHIVpxGh6AFSN1AAY8kcz3Aww921.jpg&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-2-去重过滤器"><a href="#10-2-去重过滤器" class="headerlink" title="10.2.去重过滤器"></a>10.2.去重过滤器</h2><p>在使用网络爬虫过程中，去重是一个不可避免的问题，这里需要对抓取的数据内容进行过滤，就是对车辆幸好名称进行去重过滤，避免同样条数据反复保存到数据库中。</p>
<p>传统的去重，可以使用Map或者Set集合、哈希表的方式来实现去重，在数据量较小的情况下，使用这种方式没有问题。可是当我们需要大量爬去数据的时候，这种方式就存在很大问题。因为会极大的占用内存和系统资源，导致爬虫系统崩溃。这里将会使用布隆过滤器</p>
<h3 id="10-2-1-Bloom过滤器介绍"><a href="#10-2-1-Bloom过滤器介绍" class="headerlink" title="10.2.1.Bloom过滤器介绍"></a>10.2.1.Bloom过滤器介绍</h3><p>布隆过滤器 (Bloom Filter)是由Burton Howard Bloom于1970年提出，它是一种space efficient的概率型数据结构，用于判断一个元素是否在集合中。在垃圾邮件过滤的黑白名单方法、爬虫(Crawler)的网址判重模块中等等经常被用到。<br>哈希表也能用于判断元素是否在集合中，但是布隆过滤器只需要哈希表的1&#x2F;8或1&#x2F;4的空间复杂度就能完成同样的问题。布隆过滤器可以插入元素，但不可以删除已有元素。其中的元素越多，误报率越大，但是漏报是不可能的。</p>
<p>布隆过滤器原理<br>布隆过滤器需要的是一个位数组(和位图类似)和K个映射函数(和Hash表类似)，在初始状态时，对于长度为m的位数组array，它的所有位被置0。</p>
<p>对于有n个元素的集合S&#x3D;{S1,S2…Sn},通过k个映射函数{f1,f2,……fk}，将集合S中的每个元素Sj(1&lt;&#x3D;j&lt;&#x3D;n)映射为K个值{g1,g2…gk}，然后再将位数组array中相对应的array[g1],array[g2]……array[gk]置为1：</p>
<p>如果要查找某个元素item是否在S中，则通过映射函数{f1,f2,…fk}得到k个值{g1,g2…gk}，然后再判断array[g1],array[g2]…array[gk]是否都为1，若全为1，则item在S中，否则item不在S中。</p>
<p>布隆过滤器会造成一定的误判，因为集合中的若干个元素通过映射之后得到的数值恰巧包括g1,g2,…gk，在这种情况下可能会造成误判，但是概率很小。</p>
<h3 id="10-2-2-布隆过滤器实现"><a href="#10-2-2-布隆过滤器实现" class="headerlink" title="10.2.2.布隆过滤器实现"></a>10.2.2.布隆过滤器实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//去重过滤器，布隆过滤器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TitleFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* BitSet初始分配2^24个bit */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEFAULT_SIZE</span> <span class="operator">=</span> <span class="number">1</span> &lt;&lt; <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 不同哈希函数的种子，一般应取质数 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] seeds = <span class="keyword">new</span> <span class="title class_">int</span>[] &#123; <span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">31</span>, <span class="number">37</span> &#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">BitSet</span> <span class="variable">bits</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BitSet</span>(DEFAULT_SIZE);</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 哈希函数对象 */</span></span><br><span class="line">	<span class="keyword">private</span> SimpleHash[] func = <span class="keyword">new</span> <span class="title class_">SimpleHash</span>[seeds.length];</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">BloomFilter</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; seeds.length; i++) &#123;</span><br><span class="line">			func[i] = <span class="keyword">new</span> <span class="title class_">SimpleHash</span>(DEFAULT_SIZE, seeds[i]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 将url标记到bits中</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		<span class="keyword">for</span> (SimpleHash f : func) &#123;</span><br><span class="line">			bits.set(f.hash(str), <span class="literal">true</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 判断是否已经被bits标记</span></span><br><span class="line">	<span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (StringUtils.isBlank(str)) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span> (SimpleHash f : func) &#123;</span><br><span class="line">			ret = ret &amp;&amp; bits.get(f.hash(str));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> ret;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* 哈希函数类 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SimpleHash</span> &#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> cap;</span><br><span class="line">		<span class="keyword">private</span> <span class="type">int</span> seed;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">public</span> <span class="title function_">SimpleHash</span><span class="params">(<span class="type">int</span> cap, <span class="type">int</span> seed)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.cap = cap;</span><br><span class="line">			<span class="built_in">this</span>.seed = seed;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// hash函数，采用简单的加权和hash</span></span><br><span class="line">		<span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hash</span><span class="params">(String value)</span> &#123;</span><br><span class="line">			<span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">			<span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> value.length();</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">				result = seed * result + value.charAt(i);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> (cap - <span class="number">1</span>) &amp; result;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-2-3-初始化去重过滤器"><a href="#10-2-3-初始化去重过滤器" class="headerlink" title="10.2.3.初始化去重过滤器"></a>10.2.3.初始化去重过滤器</h3><p>项目一启动，就应该创建去重过滤器。<br>编写以下代码实现过滤器初始化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TitleFilterCfg</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CarTestService carTestService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> TitleFilter <span class="title function_">titleFilter</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="comment">// 创建车辆标题过滤器</span></span><br><span class="line">		<span class="type">TitleFilter</span> <span class="variable">titleFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TitleFilter</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 从数据库查询车辆标题，分页查询</span></span><br><span class="line">		List&lt;String&gt; list = <span class="built_in">this</span>.carTestService.queryByPage(<span class="number">1</span>, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 遍历查询结果</span></span><br><span class="line">		<span class="keyword">for</span> (String str : list) &#123;</span><br><span class="line">			<span class="comment">// 把查询到的数据放到过滤器中</span></span><br><span class="line">			titleFilter.add(str);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 返回创建好的过滤器</span></span><br><span class="line">		<span class="keyword">return</span> titleFilter;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写Service接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarTestService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 分页查询数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	List&lt;String&gt; <span class="title function_">queryByPage</span><span class="params">(Integer page, Integer rows)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实现Service接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarTestServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CarTestService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CarTestMapper carTestMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;String&gt; <span class="title function_">queryByPage</span><span class="params">(Integer page, Integer rows)</span> &#123;</span><br><span class="line">		<span class="comment">// 设置从哪一条数据开始查</span></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">start</span> <span class="operator">=</span> (page - <span class="number">1</span>) * rows;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置参数</span></span><br><span class="line">		Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Integer&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;start&quot;</span>, start);</span><br><span class="line">		map.put(<span class="string">&quot;rows&quot;</span>, rows);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 分页查询数据</span></span><br><span class="line">		List&lt;String&gt; list = <span class="built_in">this</span>.carTestMapper.queryByPage(map);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 返回查询结果</span></span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写Mapper接口</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarTestMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 分页查询数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> start</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Select(&quot;SELECT title FROM car_test LIMIT #&#123;start&#125;,#&#123;rows&#125;&quot;)</span></span><br><span class="line">	List&lt;String&gt; <span class="title function_">queryByPage</span><span class="params">(Map&lt;String, Integer&gt; map)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-3-实现数据爬取"><a href="#10-3-实现数据爬取" class="headerlink" title="10.3.实现数据爬取"></a>10.3.实现数据爬取</h2><p>首先实现数据爬取逻辑，先在测试方法中实现</p>
<h3 id="10-3-1-实现爬取测试方法"><a href="#10-3-1-实现爬取测试方法" class="headerlink" title="10.3.1.实现爬取测试方法"></a>10.3.1.实现爬取测试方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = Application.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrawlerAutohome</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> ApiService apiService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CarTestService carTestService;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> TitleFilter titleFilter;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testCrawlerAutohome</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">//遍历所有的url</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">139</span>; i++) &#123;</span><br><span class="line"></span><br><span class="line">			<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="built_in">this</span>.apiService.getHtml(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span> + i);</span><br><span class="line"></span><br><span class="line">			<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 获取每获取评测信息</span></span><br><span class="line">			<span class="type">Elements</span> <span class="variable">cars</span> <span class="operator">=</span> doc.select(<span class="string">&quot;#bestautocontent div.uibox&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 遍历评测信息</span></span><br><span class="line">			<span class="keyword">for</span> (Element car : cars) &#123;</span><br><span class="line">				<span class="comment">// 去重判读</span></span><br><span class="line">				<span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> car.getElementsByClass(<span class="string">&quot;uibox-title uibox-title-border&quot;</span>).text();</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">this</span>.titleFilter.contains(title)) &#123;</span><br><span class="line">					<span class="comment">// 如果包含了，就不保存了，遍历下一个</span></span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 创建评测对象,封装数据</span></span><br><span class="line">				<span class="type">CarTest</span> <span class="variable">carTest</span> <span class="operator">=</span> <span class="built_in">this</span>.copyCarTest(car);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 评测图片，下载图片</span></span><br><span class="line">				<span class="type">String</span> <span class="variable">image</span> <span class="operator">=</span> <span class="built_in">this</span>.getImage(car);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 设置图片</span></span><br><span class="line">				carTest.setImage(image);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 保存数据</span></span><br><span class="line">				<span class="built_in">this</span>.saveCarTest(carTest);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保存汽车评测数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> carTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveCarTest</span><span class="params">(CarTest carTest)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">this</span>.titleFilter.add(carTest.getTitle());</span><br><span class="line"></span><br><span class="line">		<span class="built_in">this</span>.carTestService.saveCarTest(carTest);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 解析数据下载评测图片</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String <span class="title function_">getImage</span><span class="params">(Element car)</span> &#123;</span><br><span class="line">		List&lt;String&gt; images = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="type">Elements</span> <span class="variable">elements</span> <span class="operator">=</span> car.select(<span class="string">&quot;.piclist-box ul.piclist02 a&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span> (Element element : elements) &#123;</span><br><span class="line">			<span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https:&quot;</span> + element.attr(<span class="string">&quot;href&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="built_in">this</span>.apiService.getHtml(url);</span><br><span class="line">			<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line">			<span class="type">String</span> <span class="variable">picUrl</span> <span class="operator">=</span> <span class="string">&quot;https:&quot;</span> + doc.select(<span class="string">&quot;#img&quot;</span>).attr(<span class="string">&quot;src&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="type">String</span> <span class="variable">image</span> <span class="operator">=</span> <span class="built_in">this</span>.apiService.getImage(picUrl);</span><br><span class="line"></span><br><span class="line">			images.add(image);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> StringUtils.join(images, <span class="string">&quot;,&quot;</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 解析数据封装成汽车评测对象</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CarTest <span class="title function_">copyCarTest</span><span class="params">(Element car)</span> &#123;</span><br><span class="line">		<span class="type">CarTest</span> <span class="variable">carTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarTest</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测车辆标题</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> car.getElementsByClass(<span class="string">&quot;uibox-title uibox-title-border&quot;</span>).text();</span><br><span class="line">		carTest.setTitle(title);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测项目-加速(0-100公里/小时),单位毫秒</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">speed</span> <span class="operator">=</span> car.select(<span class="string">&quot;.tabbox1 dd:nth-child(2) div.dd-div2&quot;</span>).first().text();</span><br><span class="line">		carTest.setTest_speed(<span class="built_in">this</span>.strToNum(speed));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测项目-刹车(100-0公里/小时),单位毫米</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">brake</span> <span class="operator">=</span> car.select(<span class="string">&quot;.tabbox1 dd:nth-child(3) div.dd-div2&quot;</span>).first().text();</span><br><span class="line">		carTest.setTest_brake(<span class="built_in">this</span>.strToNum(brake));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测项目-实测油耗(升/100公里),单位毫升</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">oil</span> <span class="operator">=</span> car.select(<span class="string">&quot;.tabbox1 dd:nth-child(4) div.dd-div2&quot;</span>).first().text();</span><br><span class="line">		carTest.setTest_oil(<span class="built_in">this</span>.strToNum(oil));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测编辑1</span></span><br><span class="line">		carTest.setEditor_name1(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(2) &gt; div.dd-div1&quot;</span>).first().text());</span><br><span class="line">		<span class="comment">// 点评内容1</span></span><br><span class="line">		carTest.setEditor_remark1(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(2) &gt; div.dd-div3&quot;</span>).first().text());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测编辑2</span></span><br><span class="line">		carTest.setEditor_name2(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(3) &gt; div.dd-div1&quot;</span>).first().text());</span><br><span class="line">		<span class="comment">// 点评内容2</span></span><br><span class="line">		carTest.setEditor_remark2(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(3) &gt; div.dd-div3&quot;</span>).first().text());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测编辑3</span></span><br><span class="line">		carTest.setEditor_name3(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(4) &gt; div.dd-div1&quot;</span>).first().text());</span><br><span class="line">		<span class="comment">// 点评内容3</span></span><br><span class="line">		carTest.setEditor_remark3(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(4) &gt; div.dd-div3&quot;</span>).first().text());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置时间</span></span><br><span class="line">		carTest.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">		carTest.setUpdated(carTest.getCreated());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> carTest;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 把字符串去掉最后一个数，转为乘以1000的数字</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> speed</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="title function_">strToNum</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 字符串去掉随后一个数</span></span><br><span class="line">			str = StringUtils.substring(str, <span class="number">0</span>, str.length() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 转换为小数并乘以1000</span></span><br><span class="line">			<span class="type">Number</span> <span class="variable">num</span> <span class="operator">=</span> Float.valueOf(str) * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> num.intValue();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-2-编写CarTestService接口"><a href="#10-3-2-编写CarTestService接口" class="headerlink" title="10.3.2.编写CarTestService接口"></a>10.3.2.编写CarTestService接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarTestService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 分页查询数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> page</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	List&lt;String&gt; <span class="title function_">queryByPage</span><span class="params">(Integer page, Integer rows)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保存数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> carTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">saveCarTest</span><span class="params">(CarTest carTest)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-3-编写CarTestService接口实现"><a href="#10-3-3-编写CarTestService接口实现" class="headerlink" title="10.3.3.编写CarTestService接口实现"></a>10.3.3.编写CarTestService接口实现</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarTestServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">CarTestService</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> CarTestMapper carTestMapper;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> List&lt;String&gt; <span class="title function_">queryByPage</span><span class="params">(Integer page, Integer rows)</span> &#123;</span><br><span class="line">		<span class="comment">// 设置从哪一条数据开始查</span></span><br><span class="line">		<span class="type">Integer</span> <span class="variable">start</span> <span class="operator">=</span> (page - <span class="number">1</span>) * rows;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置参数</span></span><br><span class="line">		Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Integer&gt;();</span><br><span class="line">		map.put(<span class="string">&quot;start&quot;</span>, start);</span><br><span class="line">		map.put(<span class="string">&quot;rows&quot;</span>, rows);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 分页查询数据</span></span><br><span class="line">		List&lt;String&gt; list = <span class="built_in">this</span>.carTestMapper.queryByPage(map);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 返回查询结果</span></span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveCarTest</span><span class="params">(CarTest carTest)</span> &#123;</span><br><span class="line">		<span class="built_in">this</span>.carTestMapper.save(carTest);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-3-4-编写CarTestMapper"><a href="#10-3-4-编写CarTestMapper" class="headerlink" title="10.3.4.编写CarTestMapper"></a>10.3.4.编写CarTestMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CarTestMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 分页查询数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> start</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> rows</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Select(&quot;SELECT title FROM car_test LIMIT #&#123;start&#125;,#&#123;rows&#125;&quot;)</span></span><br><span class="line">	List&lt;String&gt; <span class="title function_">queryByPage</span><span class="params">(Map&lt;String, Integer&gt; map)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保存</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> carTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="meta">@Insert(</span></span><br><span class="line"><span class="meta">	&quot;INSERT INTO `car_test` (&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`title`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`test_speed`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`test_brake`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`test_oil`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`editor_name1`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`editor_remark1`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`editor_name2`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`editor_remark2`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`editor_name3`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`editor_remark3`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`image`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`created`,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	`updated`&quot; +</span></span><br><span class="line"><span class="meta">	&quot;)&quot; +</span></span><br><span class="line"><span class="meta">	&quot;VALUES&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	(&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;title&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;test_speed&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;test_brake&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;test_oil&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;editor_name1&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;editor_remark1&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;editor_name2&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;editor_remark2&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;editor_name3&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;editor_remark3&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;image&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;created&#125;,&quot; +</span></span><br><span class="line"><span class="meta">	&quot;		#&#123;updated&#125;&quot; +</span></span><br><span class="line"><span class="meta">	&quot;	)&quot;)</span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">save</span><span class="params">(CarTest carTest)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="10-4-整合任务"><a href="#10-4-整合任务" class="headerlink" title="10.4.整合任务"></a>10.4.整合任务</h2><p>把测试方法中的爬取数据代码改造为任务，再使用Quartz定时任务定时处理，就可以实现定时抓取汽车评测数据，能够获取最新的数据了</p>
<h3 id="10-4-1-改造任务"><a href="#10-4-1-改造任务" class="headerlink" title="10.4.1.改造任务"></a>10.4.1.改造任务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//同步执行任务(单线程)</span></span><br><span class="line"><span class="meta">@DisallowConcurrentExecution</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CrawlerAutohomeJob</span> <span class="keyword">extends</span> <span class="title class_">QuartzJobBean</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> ApiService apiService;</span><br><span class="line">	<span class="keyword">private</span> CarTestService carTestService;</span><br><span class="line">	<span class="keyword">private</span> TitleFilter titleFilter;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException &#123;</span><br><span class="line">		<span class="comment">// 获取spring容器</span></span><br><span class="line">		<span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> (ApplicationContext) context.getJobDetail().getJobDataMap()</span><br><span class="line">				.get(<span class="string">&quot;context&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 获取抓取数据服务</span></span><br><span class="line">		<span class="built_in">this</span>.apiService = applicationContext.getBean(ApiService.class);</span><br><span class="line">		<span class="comment">// 获取汽车评测服务</span></span><br><span class="line">		<span class="built_in">this</span>.carTestService = applicationContext.getBean(CarTestService.class);</span><br><span class="line">		<span class="comment">// 获取过滤器</span></span><br><span class="line">		<span class="built_in">this</span>.titleFilter = applicationContext.getBean(TitleFilter.class);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 遍历所有的url</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">139</span>; i++) &#123;</span><br><span class="line">			<span class="comment">// 抓取页面数据</span></span><br><span class="line">			<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="built_in">this</span>.apiService.getHtml(<span class="string">&quot;https://www.autohome.com.cn/bestauto/&quot;</span> + i);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 使用jsoup解析为Document对象</span></span><br><span class="line">			<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 获取每获取评测信息</span></span><br><span class="line">			<span class="type">Elements</span> <span class="variable">cars</span> <span class="operator">=</span> doc.select(<span class="string">&quot;#bestautocontent div.uibox&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 遍历评测信息</span></span><br><span class="line">			<span class="keyword">for</span> (Element car : cars) &#123;</span><br><span class="line">				<span class="comment">// 去重判读</span></span><br><span class="line">				<span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> car.getElementsByClass(<span class="string">&quot;uibox-title uibox-title-border&quot;</span>).text();</span><br><span class="line">				<span class="keyword">if</span> (<span class="built_in">this</span>.titleFilter.contains(title)) &#123;</span><br><span class="line">					<span class="comment">// 如果包含了，就不保存了，遍历下一个</span></span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 创建评测对象,封装数据</span></span><br><span class="line">				<span class="type">CarTest</span> <span class="variable">carTest</span> <span class="operator">=</span> <span class="built_in">this</span>.copyCarTest(car);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 评测图片，下载图片</span></span><br><span class="line">				<span class="type">String</span> <span class="variable">image</span> <span class="operator">=</span> <span class="built_in">this</span>.getImage(car);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 设置图片</span></span><br><span class="line">				carTest.setImage(image);</span><br><span class="line"></span><br><span class="line">				<span class="comment">// 保存数据</span></span><br><span class="line">				<span class="built_in">this</span>.saveCarTest(carTest);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保存汽车评测数据</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> carTest</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">saveCarTest</span><span class="params">(CarTest carTest)</span> &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">this</span>.titleFilter.add(carTest.getTitle());</span><br><span class="line"></span><br><span class="line">		<span class="built_in">this</span>.carTestService.saveCarTest(carTest);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 解析数据下载评测图片</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String <span class="title function_">getImage</span><span class="params">(Element car)</span> &#123;</span><br><span class="line">		List&lt;String&gt; images = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">		<span class="type">Elements</span> <span class="variable">elements</span> <span class="operator">=</span> car.select(<span class="string">&quot;.piclist-box ul.piclist02 a&quot;</span>);</span><br><span class="line">		<span class="keyword">for</span> (Element element : elements) &#123;</span><br><span class="line">			<span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https:&quot;</span> + element.attr(<span class="string">&quot;href&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> <span class="built_in">this</span>.apiService.getHtml(url);</span><br><span class="line">			<span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> Jsoup.parse(html);</span><br><span class="line">			<span class="type">String</span> <span class="variable">picUrl</span> <span class="operator">=</span> <span class="string">&quot;https:&quot;</span> + doc.select(<span class="string">&quot;#img&quot;</span>).attr(<span class="string">&quot;src&quot;</span>);</span><br><span class="line"></span><br><span class="line">			<span class="type">String</span> <span class="variable">image</span> <span class="operator">=</span> <span class="built_in">this</span>.apiService.getImage(picUrl);</span><br><span class="line"></span><br><span class="line">			images.add(image);</span><br><span class="line"></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> images.toString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 解析数据封装成汽车评测对象</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> car</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CarTest <span class="title function_">copyCarTest</span><span class="params">(Element car)</span> &#123;</span><br><span class="line">		<span class="type">CarTest</span> <span class="variable">carTest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarTest</span>();</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测车辆标题</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> car.getElementsByClass(<span class="string">&quot;uibox-title uibox-title-border&quot;</span>).text();</span><br><span class="line">		carTest.setTitle(title);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测项目-加速(0-100公里/小时),单位毫秒</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">speed</span> <span class="operator">=</span> car.select(<span class="string">&quot;.tabbox1 dd:nth-child(2) div.dd-div2&quot;</span>).first().text();</span><br><span class="line">		carTest.setTest_speed(<span class="built_in">this</span>.strToNum(speed));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测项目-刹车(100-0公里/小时),单位毫米</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">brake</span> <span class="operator">=</span> car.select(<span class="string">&quot;.tabbox1 dd:nth-child(3) div.dd-div2&quot;</span>).first().text();</span><br><span class="line">		carTest.setTest_brake(<span class="built_in">this</span>.strToNum(brake));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测项目-实测油耗(升/100公里),单位毫升</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">oil</span> <span class="operator">=</span> car.select(<span class="string">&quot;.tabbox1 dd:nth-child(4) div.dd-div2&quot;</span>).first().text();</span><br><span class="line">		carTest.setTest_oil(<span class="built_in">this</span>.strToNum(oil));</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测编辑1</span></span><br><span class="line">		carTest.setEditor_name1(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(2) &gt; div.dd-div1&quot;</span>).first().text());</span><br><span class="line">		<span class="comment">// 点评内容1</span></span><br><span class="line">		carTest.setEditor_remark1(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(2) &gt; div.dd-div3&quot;</span>).first().text());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测编辑2</span></span><br><span class="line">		carTest.setEditor_name2(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(3) &gt; div.dd-div1&quot;</span>).first().text());</span><br><span class="line">		<span class="comment">// 点评内容2</span></span><br><span class="line">		carTest.setEditor_remark2(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(3) &gt; div.dd-div3&quot;</span>).first().text());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 评测编辑3</span></span><br><span class="line">		carTest.setEditor_name3(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(4) &gt; div.dd-div1&quot;</span>).first().text());</span><br><span class="line">		<span class="comment">// 点评内容3</span></span><br><span class="line">		carTest.setEditor_remark3(car.select(<span class="string">&quot;.tabbox2 dd:nth-child(4) &gt; div.dd-div3&quot;</span>).first().text());</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 设置时间</span></span><br><span class="line">		carTest.setCreated(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">		carTest.setUpdated(carTest.getCreated());</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> carTest;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 把字符串去掉最后一个数，转为乘以1000的数字</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> speed</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="type">int</span> <span class="title function_">strToNum</span><span class="params">(String str)</span> &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">// 字符串去掉随后一个数</span></span><br><span class="line">			str = StringUtils.substring(str, <span class="number">0</span>, str.length() - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">// 转换为小数并乘以1000</span></span><br><span class="line">			<span class="type">Number</span> <span class="variable">num</span> <span class="operator">=</span> Float.valueOf(str) * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">return</span> num.intValue();</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">			System.out.println(str);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-4-2-定时处理任务"><a href="#10-4-2-定时处理任务" class="headerlink" title="10.4.2.定时处理任务"></a>10.4.2.定时处理任务</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SchedledCfg</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义关闭无效连接任务</span></span><br><span class="line">	<span class="meta">@Bean(&quot;crawlerAutohomeJobBean&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> JobDetailFactoryBean <span class="title function_">crawlerAutohomeJobBean</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">JobDetailFactoryBean</span> <span class="variable">jobDetailFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JobDetailFactoryBean</span>();</span><br><span class="line">		jobDetailFactoryBean.setApplicationContextJobDataKey(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">		jobDetailFactoryBean.setJobClass(CrawlerAutohomeJob.class);</span><br><span class="line">		jobDetailFactoryBean.setDurability(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> jobDetailFactoryBean;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义关闭无效连接触发器</span></span><br><span class="line">	<span class="meta">@Bean(&quot;crawlerAutohomeJobTrigger&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> CronTriggerFactoryBean <span class="title function_">crawlerAutohomeJobTrigger</span><span class="params">(</span></span><br><span class="line"><span class="params">			<span class="meta">@Qualifier(value = &quot;crawlerAutohomeJobBean&quot;)</span> JobDetailFactoryBean itemJobBean)</span> &#123;</span><br><span class="line">		<span class="type">CronTriggerFactoryBean</span> <span class="variable">tigger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CronTriggerFactoryBean</span>();</span><br><span class="line">		tigger.setJobDetail(itemJobBean.getObject());</span><br><span class="line">		tigger.setCronExpression(<span class="string">&quot;0/5 * * * * ? &quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> tigger;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 定义关闭无效连接任务</span></span><br><span class="line">	<span class="meta">@Bean(&quot;closeConnectJobBean&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> JobDetailFactoryBean <span class="title function_">closeConnectJobBean</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="type">JobDetailFactoryBean</span> <span class="variable">jobDetailFactoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JobDetailFactoryBean</span>();</span><br><span class="line">		jobDetailFactoryBean.setApplicationContextJobDataKey(<span class="string">&quot;context&quot;</span>);</span><br><span class="line">		jobDetailFactoryBean.setJobClass(CloseConnectJob.class);</span><br><span class="line">		jobDetailFactoryBean.setDurability(<span class="literal">true</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> jobDetailFactoryBean;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 定义关闭无效连接触发器</span></span><br><span class="line">	<span class="meta">@Bean(&quot;closeConnectJobTrigger&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> CronTriggerFactoryBean <span class="title function_">closeConnectJobTrigger</span><span class="params">(</span></span><br><span class="line"><span class="params">			<span class="meta">@Qualifier(value = &quot;closeConnectJobBean&quot;)</span> JobDetailFactoryBean itemJobBean)</span> &#123;</span><br><span class="line">		<span class="type">CronTriggerFactoryBean</span> <span class="variable">tigger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CronTriggerFactoryBean</span>();</span><br><span class="line">		tigger.setJobDetail(itemJobBean.getObject());</span><br><span class="line">		tigger.setCronExpression(<span class="string">&quot;0/5 * * * * ? &quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> tigger;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 定义调度器</span></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="keyword">public</span> SchedulerFactoryBean <span class="title function_">schedulerFactory</span><span class="params">(CronTrigger[] cronTriggerImpl)</span> &#123;</span><br><span class="line">		<span class="type">SchedulerFactoryBean</span> <span class="variable">bean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SchedulerFactoryBean</span>();</span><br><span class="line">		bean.setTriggers(cronTriggerImpl);</span><br><span class="line">		<span class="keyword">return</span> bean;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="11-动态网页"><a href="#11-动态网页" class="headerlink" title="11.动态网页"></a>11.动态网页</h1><p>我们可以分析静态页面html，但是对js的解析部分还是很薄弱。虽然我们可以读取js的运作机制并且找到相关数据，但是这样会耗费大量时间。</p>
<p>除了人力解析js以外，我们还可以使用工具来模拟浏览器的运行，直接获取解析结果。这里我们使用</p>
<h2 id="11-1-phantomJs-selenium"><a href="#11-1-phantomJs-selenium" class="headerlink" title="11.1.phantomJs+selenium"></a>11.1.phantomJs+selenium</h2><ul>
<li>（1）一个基于webkit内核的无头浏览器，即没有UI界面，即它就是一个浏览器，只是其内的点击、翻页等人为相关操作需要程序设计实现。</li>
<li>（2）提供javascript API接口，即通过编写js程序可以直接与webkit内核交互，在此之上可以结合java语言等，通过java调用js等相关操作，从而解决了以前c&#x2F;c++才能比较好的基于webkit开发优质采集器的限制。</li>
<li>（3）提供windows、linux、mac等不同os的安装使用包，也就是说可以在不同平台上二次开发采集项目或是自动项目测试等工作。</li>
</ul>
<p>下载phantomJs<br>在官网上下载<br><a target="_blank" rel="noopener" href="http://phantomjs.org/download.html">http://phantomjs.org/download.html</a></p>
<p>selenium官网<br><a target="_blank" rel="noopener" href="http://www.seleniumhq.org/projects/webdriver/">http://www.seleniumhq.org/projects/webdriver/</a></p>
<h2 id="11-2-加入依赖"><a href="#11-2-加入依赖" class="headerlink" title="11.2.加入依赖"></a>11.2.加入依赖</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- selenium --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.seleniumhq.selenium<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>selenium-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!-- phantomjsdriver --&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.codeborne<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>phantomjsdriver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="11-3-测试代码"><a href="#11-3-测试代码" class="headerlink" title="11.3.测试代码"></a>11.3.测试代码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123; <span class="comment">// 设置必要参数</span></span><br><span class="line">	<span class="type">DesiredCapabilities</span> <span class="variable">dcaps</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DesiredCapabilities</span>();</span><br><span class="line">	<span class="comment">// ssl证书支持</span></span><br><span class="line">	dcaps.setCapability(<span class="string">&quot;acceptSslCerts&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">	<span class="comment">// css搜索支持</span></span><br><span class="line">	dcaps.setCapability(<span class="string">&quot;cssSelectorsEnabled&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">	<span class="comment">// js支持</span></span><br><span class="line">	dcaps.setJavascriptEnabled(<span class="literal">true</span>);</span><br><span class="line">	<span class="comment">// 驱动支持</span></span><br><span class="line">	dcaps.setCapability(PhantomJSDriverService.PHANTOMJS_EXECUTABLE_PATH_PROPERTY,</span><br><span class="line">			<span class="string">&quot;E:\\phantomjs-2.1.1-windows\\bin\\phantomjs.exe&quot;</span>);</span><br><span class="line">	<span class="comment">// // 创建无界面浏览器对象</span></span><br><span class="line">	<span class="type">WebDriver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PhantomJSDriver</span>(dcaps);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">		<span class="comment">// 让浏览器访问空间主页</span></span><br><span class="line">		driver.manage().timeouts().implicitlyWait(<span class="number">5</span>, TimeUnit.SECONDS);</span><br><span class="line">		driver.get(<span class="string">&quot;https://item.jd.com/4391570.html&quot;</span>);</span><br><span class="line">		Thread.sleep(<span class="number">5000l</span>);</span><br><span class="line">		<span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> driver.getPageSource();</span><br><span class="line">		<span class="type">Writer</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileWriter</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;D:/httpclient.html&quot;</span>));</span><br><span class="line">		out.write(html);</span><br><span class="line">		out.close();</span><br><span class="line"></span><br><span class="line">		<span class="type">WebElement</span> <span class="variable">element</span> <span class="operator">=</span> driver</span><br><span class="line">				.findElement(By.xpath(<span class="string">&quot;/html/body/div[5]/div/div[2]/div[4]/div/div[1]/div[2]/span[1]/span[2]&quot;</span>));</span><br><span class="line">		System.out.println(element.getText());</span><br><span class="line"></span><br><span class="line">	&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">		e.printStackTrace();</span><br><span class="line">	&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">		<span class="comment">// 关闭并退出浏览器</span></span><br><span class="line">		driver.close();</span><br><span class="line">		driver.quit();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="12-爬虫攻防技术"><a href="#12-爬虫攻防技术" class="headerlink" title="12.爬虫攻防技术"></a>12.爬虫攻防技术</h1><h2 id="12-1如何识别爬虫"><a href="#12-1如何识别爬虫" class="headerlink" title="12.1如何识别爬虫"></a>12.1如何识别爬虫</h2><h2 id="12-1-1-如何发现爬虫"><a href="#12-1-1-如何发现爬虫" class="headerlink" title="12.1.1 如何发现爬虫"></a>12.1.1 如何发现爬虫</h2><ul>
<li>单一IP非常规的访问频次</li>
<li>单一IP非常规的数据流量</li>
<li>大量重复简单点的网站浏览行为</li>
<li>只下载网页，没有后续的JS\CSS请求</li>
<li>设置陷阱，使用hidden属性对用户隐藏标签但爬虫可见。</li>
<li>判断请求头</li>
<li>判断cookie</li>
</ul>
<h3 id="12-1-2-如何避免被发现"><a href="#12-1-2-如何避免被发现" class="headerlink" title="12.1.2 如何避免被发现"></a>12.1.2 如何避免被发现</h3><ul>
<li>多主机策略，分布式爬取。</li>
<li>调整爬取速度</li>
<li>通过变换IP地址或者使用代理服务器来演示</li>
<li>频繁修改自己的User-Agent</li>
<li>Header中的Cache-Control修改为no-cache</li>
<li>当返回状态码是403（服务器资源禁止访问），改变Header和IP。不断改变。</li>
</ul>
<h3 id="12-1-3-使用代理IP绕过爬虫策略"><a href="#12-1-3-使用代理IP绕过爬虫策略" class="headerlink" title="12.1.3 使用代理IP绕过爬虫策略"></a>12.1.3 使用代理IP绕过爬虫策略</h3><p><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B12.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<ul>
<li>从网站上爬取代理IP地址（一般不可用）</li>
<li>从淘宝上购买便宜的IP地址（2000条2块）</li>
<li>购买正规的代理服务（昂贵）</li>
<li>使用阿里云试试</li>
</ul>
<h2 id="12-2-如何使用代理IP绕过网站监测"><a href="#12-2-如何使用代理IP绕过网站监测" class="headerlink" title="12.2 如何使用代理IP绕过网站监测"></a>12.2 如何使用代理IP绕过网站监测</h2><ul>
<li>① 购买代理IP</li>
<li>② 每次请求使用一个代理IP</li>
<li>③ 配置代理</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpHost</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHost</span>(ip, port);</span><br><span class="line"><span class="type">ConnectionConfig</span> <span class="variable">connectionConfig</span> <span class="operator">=</span> ConnectionConfig.custom().setBufferSize(<span class="number">4128</span>).build();</span><br><span class="line"><span class="type">DefaultProxyRoutePlanner</span> <span class="variable">routePlanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultProxyRoutePlanner</span>(proxy);</span><br><span class="line"><span class="type">CloseableHttpClient</span> <span class="variable">hc</span> <span class="operator">=</span> HttpClients.custom().setDefaultConnectionConfig(connectionConfig).setRoutePlanner(routePlanner).build();</span><br></pre></td></tr></table></figure>

<ul>
<li>④ 发起请求</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> doVote4FenDou;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.nio.charset.Charset;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ArrayBlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.http.Header;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.ClientProtocolException;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.CloseableHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpGet;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.client.methods.HttpPost;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.config.ConnectionConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.CloseableHttpClient;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.client.HttpClients;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.impl.conn.DefaultProxyRoutePlanner;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.util.EntityUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoVote</span> &#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       multiThread();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 使用多线程进行爬取</span></span><br><span class="line"><span class="comment">    **/</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">multiThread</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException, IOException, InterruptedException &#123;</span><br><span class="line">      <span class="comment">//1.创建阻塞队列用来存放代理IP地址</span></span><br><span class="line">      <span class="keyword">final</span> ArrayBlockingQueue&lt;String&gt; arrayBlockingQueue = <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;String&gt;(<span class="number">10000</span>);</span><br><span class="line">      <span class="comment">//2.读取文件，该文件中保存着代理ip和端口号。如 103.29.186.189:3128</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">ips</span> <span class="operator">=</span> FileUtil.readFileToString(<span class="string">&quot;C:/workspace/eclipse/mars/doVote4FenDou/src/main/resources/ips.txt&quot;</span>);</span><br><span class="line">      String[] ipkv = ips.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">      System.out.println(<span class="string">&quot;total ips:&quot;</span>+ipkv.length);</span><br><span class="line">      <span class="keyword">for</span> (String ip : ipkv) &#123;</span><br><span class="line">         System.out.println(ip);</span><br><span class="line">         arrayBlockingQueue.put(ip);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line">      <span class="comment">//3.开启多线程进行投票</span></span><br><span class="line">      <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> Executors.newFixedThreadPool(size);</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">         pool.submit(<span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">               <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                  <span class="keyword">try</span> &#123;</span><br><span class="line">                     <span class="type">String</span> <span class="variable">ipkv</span> <span class="operator">=</span> arrayBlockingQueue.take();</span><br><span class="line">                     System.out.println(ipkv);</span><br><span class="line">                     String[] kv = ipkv.split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">                     dovote(kv[<span class="number">0</span>], Integer.parseInt(kv[<span class="number">1</span>]));</span><br><span class="line">                  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                     System.out.println(<span class="string">&quot;请求失败!&quot;</span> + e);</span><br><span class="line">                  &#125;</span><br><span class="line">               &#125;</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;));</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">dovote</span><span class="params">(String ip, <span class="type">int</span> port)</span> <span class="keyword">throws</span> IOException, ClientProtocolException &#123;</span><br><span class="line">      <span class="comment">//1.投票的请求接口</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;http://fendou.itcast.cn/article/updatevote&quot;</span>;</span><br><span class="line">      <span class="comment">//2.准备请求头的信息</span></span><br><span class="line">      Map&lt;String, String&gt; headers = getHeader();</span><br><span class="line">      <span class="comment">//3.创建POST请求对象</span></span><br><span class="line">      <span class="type">HttpPost</span> <span class="variable">httpPost</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpPost</span>(url);</span><br><span class="line">      <span class="comment">//4.准备请求头的信息</span></span><br><span class="line">      <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; header : headers.entrySet()) &#123;</span><br><span class="line">         httpPost.addHeader(header.getKey(), header.getValue());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//5.创建代理HTTP请求</span></span><br><span class="line">      <span class="type">HttpHost</span> <span class="variable">proxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHost</span>(ip, port);</span><br><span class="line">      <span class="type">ConnectionConfig</span> <span class="variable">connectionConfig</span> <span class="operator">=</span> ConnectionConfig.custom().setBufferSize(<span class="number">4128</span>).build();</span><br><span class="line">      <span class="type">DefaultProxyRoutePlanner</span> <span class="variable">routePlanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultProxyRoutePlanner</span>(proxy);</span><br><span class="line">      <span class="type">CloseableHttpClient</span> <span class="variable">hc</span> <span class="operator">=</span> HttpClients.custom().setDefaultConnectionConfig(connectionConfig)</span><br><span class="line">            .setRoutePlanner(routePlanner).build();</span><br><span class="line">      <span class="comment">//6.使用代理HttpClient发起投票请求</span></span><br><span class="line">      <span class="type">CloseableHttpResponse</span> <span class="variable">res</span> <span class="operator">=</span> hc.execute(httpPost);</span><br><span class="line">      <span class="comment">//7.打印http请求状态码</span></span><br><span class="line">      System.out.println(<span class="string">&quot;statusCode:&quot;</span> + res.getStatusLine().getStatusCode());</span><br><span class="line">      <span class="keyword">for</span> (Header header : res.getAllHeaders()) &#123;</span><br><span class="line">         <span class="comment">//8.打印所有的response header信息，发现有set-cookie的信息就成功了。</span></span><br><span class="line">         System.out.println(header);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//9.打印html信息 如果返回为空字符串 就是投票成功。有返回值的基本就是失败了。</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">html</span> <span class="operator">=</span> EntityUtils.toString(res.getEntity(), Charset.forName(<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">      System.out.println(<span class="string">&quot;返回值:&quot;</span> + html);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">getPS</span><span class="params">(CloseableHttpClient hc)</span> <span class="keyword">throws</span> IOException, ClientProtocolException &#123;</span><br><span class="line">      <span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span></span><br><span class="line">             <span class="title class_">HttpGet</span>(<span class="string">&quot;http://fendou.itcast.cn/article/look/aid/193?qq-pf-to=pcqq.c2c&quot;</span>);</span><br><span class="line">       <span class="type">CloseableHttpResponse</span> <span class="variable">res1</span> <span class="operator">=</span> hc.execute(httpGet);</span><br><span class="line">       <span class="type">String</span> <span class="variable">ps</span> <span class="operator">=</span> res1.getHeaders(<span class="string">&quot;set-cookie&quot;</span>)[<span class="number">0</span>].getValue();</span><br><span class="line">      <span class="keyword">return</span> ps;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, String&gt; <span class="title function_">getHeader</span><span class="params">()</span> &#123;</span><br><span class="line">      HashMap&lt;String, String&gt; headers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, String&gt;();</span><br><span class="line">      headers.put(<span class="string">&quot;Referer&quot;</span>, <span class="string">&quot;http://fendou.itcast.cn/article/look/aid/193?qq-pf-to=pcqq.c2c&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;host&quot;</span>, <span class="string">&quot;fendou.itcast.cn&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;Origin&quot;</span>, <span class="string">&quot;http://fendou.itcast.cn&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;User-Agent&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;X-Requested-With&quot;</span>, <span class="string">&quot;XMLHttpRequest&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;cookie&quot;</span>, <span class="string">&quot;PHPSESSID=8bj2oolgfq23idj1n3qofmm893; UM_distinctid=15e0d154d8a617-095bb15b8b50fd-414a0229-100200-15e0d154d8b4b3&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      headers.put(<span class="string">&quot;Accept&quot;</span>, <span class="string">&quot;*/*&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;Accept-Encoding&quot;</span>, <span class="string">&quot;gzip, deflate&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;Accept-Language&quot;</span>, <span class="string">&quot;zh-CN,zh;q=0.8&quot;</span>);</span><br><span class="line">      headers.put(<span class="string">&quot;Connection&quot;</span>, <span class="string">&quot;keep-alive&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span> headers;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="12-4如何绕过网站验证码"><a href="#12-4如何绕过网站验证码" class="headerlink" title="12.4	如何绕过网站验证码"></a>12.4	如何绕过网站验证码</h2><h3 id="12-4-1一些经验"><a href="#12-4-1一些经验" class="headerlink" title="12.4.1一些经验"></a>12.4.1一些经验</h3><ul>
<li>1、绕过验证码。跳过验证码直接访问需要的页面内容。</li>
<li>2、请求头中自带验证码。有些网站的验证码会在前台js校验。服务器生成的验证码会在请求头中。可以获取请求头，并把验证码解析出来。</li>
<li>3、session不刷新。国内很多网站存在一个通病：验证码验证成功后，直接获取请求资源。（忘记了刷新cookie对应的验证码）可以预先设定一个cookie和验证码。利用这个漏洞访问网站。对于多线程无法控制以及有些网站验证码定期不访问失效问题。可以添加一个定时访问程序来解决</li>
<li>4、利用第三方插件。对于有些网站验证码比较简单。只含阿拉伯数字和英文字母。可以用第三方的插件来识别。例如：tess4j、tesseract</li>
<li>5、有些网站的验证码是从库中随机取出一个来的。对于这类静态的验证码。可以自己建立一个验证码静态库。自己建立好图片和验证码答案的链接。采用map的映射方法就可以进行识别参见。</li>
<li>6、自己定制写验证码的程序</li>
</ul>
<h1 id="12-其他信息提取"><a href="#12-其他信息提取" class="headerlink" title="12.其他信息提取"></a>12.其他信息提取</h1><h2 id="12-1-图像的OCR识别"><a href="#12-1-图像的OCR识别" class="headerlink" title="12.1.图像的OCR识别"></a>12.1.图像的OCR识别</h2><h3 id="12-1-1-OCR介绍"><a href="#12-1-1-OCR介绍" class="headerlink" title="12.1.1.OCR介绍"></a>12.1.1.OCR介绍</h3><p>抓取过程中，如果碰到需要获取的数据是图片的格式，那么我们还需要把图片转换成文字。</p>
<p>从图片中识别出字符叫做光学字符识别（Optical Character Recognition）简称OCR。是指电子设备（例如扫描仪或数码相机）检查纸上打印的字符，通过检测暗、亮的模式确定其形状，然后用字符识别方法将形状翻译成计算机文字的过程。即，针对印刷体字符，采用光学的方式将纸质文档中的文字转换成为黑白点阵的图像文件，并通过识别软件将图像中的文字转换成文本格式。</p>
<p>文字识别包括以下几个步骤： </p>
<ul>
<li><p>(1)图文输入<br>是指通过输入图片到计算机中，也就是获取图片。</p>
</li>
<li><p>(2)预处理 扫描一幅简单的印刷文档的图像，将每一个文字图像分检出来交给识别模块识别，这一过程称为图像预处理。预处理是指在进行文字识别之前的一些准备工作，包括图像净化处理，去掉原始图像中的显见噪声(干扰)， </p>
</li>
<li><p>(3)单字识别<br>单字识别是体现OCR文字识别的核心技术。从扫描文本中分检出的文字图像，由计算机将其图形，图像转变成文字的标准代码.，是让计算机“认字”的关键，也就是所谓的识别技术。<br>识别技术就是特征比较技术，通过和识别特征库的比较，找到特征最相似的字，提取该文字的标准代码，即为识别结果。</p>
</li>
<li><p>(4)后处理<br>后处理是指对识别出的文字或多个识别结果采用词组方式进行上下匹配，即将单字识别的结果进行分词，与词库中的词组进行比较，以提高系统的识别率，减少误识率。 汉字字符识别是文字识别领域最为困难的问题，它涉及模式识别，图像处理，数字信号处理，自然语言理解，人工智能，模糊数学，信息论，计算机，中文信息处理等学科，是一门综合性技术。</p>
</li>
</ul>
<h3 id="12-1-2-Tess4j"><a href="#12-1-2-Tess4j" class="headerlink" title="12.1.2.Tess4j"></a>12.1.2.Tess4j</h3><p>Tess4J是一个OCR图片识别技术，我们这里使用的是Tess4J-3.4.2。在windows使用前必须安装Visual C++ 2015 Redistributable Packages，下载地址：<br><a target="_blank" rel="noopener" href="https://www.microsoft.com/zh-CN/download/details.aspx?id=48145%EF%BC%89">https://www.microsoft.com/zh-CN/download/details.aspx?id=48145）</a></p>
<p>首先需要在pom.xml中添加以下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>net.sourceforge.tess4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tess4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.25<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在项目的根路径下复制tessdata文件夹</p>
<p>Tess4j对多种语言都提供相关的语言包，可以在以下地址下载<br><a target="_blank" rel="noopener" href="https://github.com/tesseract-ocr/tessdata">https://github.com/tesseract-ocr/tessdata</a></p>
<p>我们这里实现的是识别图片中的数字。编写测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.createDefault();</span><br><span class="line">	<span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://proxy.mimvp.com/common/ygrandimg.php?id=17&amp;port=MmDiZmtvapW12cDMxMjgO0O&quot;</span>;</span><br><span class="line">	<span class="type">HttpGet</span> <span class="variable">httpGet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpGet</span>(url);</span><br><span class="line">	<span class="type">CloseableHttpResponse</span> <span class="variable">response</span> <span class="operator">=</span> httpClient.execute(httpGet);</span><br><span class="line">	<span class="type">HttpEntity</span> <span class="variable">httpEntity</span> <span class="operator">=</span> response.getEntity();</span><br><span class="line">	<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> httpEntity.getContent();</span><br><span class="line">	<span class="type">BufferedImage</span> <span class="variable">image</span> <span class="operator">=</span> ImageIO.read(inputStream);</span><br><span class="line">	<span class="comment">// BufferedImage image = ImageIO.read(new</span></span><br><span class="line">	<span class="comment">// File(&quot;C:/Users/tree/Desktop/53281.png&quot;));</span></span><br><span class="line"></span><br><span class="line">	image = image.getSubimage(<span class="number">4</span>, <span class="number">8</span>, <span class="number">42</span>, <span class="number">17</span>);</span><br><span class="line">	<span class="type">Image</span> <span class="variable">scaledInstance</span> <span class="operator">=</span> image.getScaledInstance(<span class="number">46</span>, <span class="number">25</span>, image.SCALE_SMOOTH);<span class="comment">// 设置缩放目标图片模板</span></span><br><span class="line"></span><br><span class="line">	<span class="type">AffineTransformOp</span> <span class="variable">ato</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AffineTransformOp</span>(AffineTransform.getScaleInstance(<span class="number">2.5</span>, <span class="number">2.5</span>), <span class="literal">null</span>);</span><br><span class="line">	scaledInstance = ato.filter(image, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">	<span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;tessdata/temp.jpg&quot;</span>);</span><br><span class="line">	ImageIO.write((BufferedImage) scaledInstance, <span class="string">&quot;jpg&quot;</span>, file);</span><br><span class="line"></span><br><span class="line">	<span class="type">ITesseract</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tesseract</span>();</span><br><span class="line">	instance.setLanguage(<span class="string">&quot;eng&quot;</span>);</span><br><span class="line">	<span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">	<span class="type">String</span> <span class="variable">ocrResult</span> <span class="operator">=</span> instance.doOCR(file);</span><br><span class="line">	<span class="comment">// 输出识别结果</span></span><br><span class="line">	System.out.println(<span class="string">&quot;OCR Result: \n&quot;</span> + ocrResult + <span class="string">&quot;耗时：&quot;</span> + (System.currentTimeMillis() - startTime) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="12-1-3-使用第三方服务识别验证码"><a href="#12-1-3-使用第三方服务识别验证码" class="headerlink" title="12.1.3 使用第三方服务识别验证码"></a>12.1.3 使用第三方服务识别验证码</h3><p>最好的方式是买买买。<br><a target="_blank" rel="noopener" href="http://www.dama2.com/">http://www.dama2.com/</a></p>
<p><img src="https://kcfl.oss-cn-beijing.aliyuncs.com/typora%E5%BC%80%E5%A7%8B13.png" alt="输入图片说明" title="QQ截图20201229183512.png"></p>
<h2 id="12-2-从非html提取文本"><a href="#12-2-从非html提取文本" class="headerlink" title="12.2.从非html提取文本"></a>12.2.从非html提取文本</h2><h3 id="12-2-1-PDF文件"><a href="#12-2-1-PDF文件" class="headerlink" title="12.2.1.PDF文件"></a>12.2.1.PDF文件</h3><p>PDF 是 Adobe公司开发的电子文件格式。这种文件格式与操作系统的平台无关，可以在多数操作系统上通用。</p>
<pre><code>我们经常会遇到这种情况，就是想把PDF文件中的文字复制下来，却发现不能复制，因为PDF文件的内容可能加密了，那么把PDF文件中的内容提取出来就是我们要解决的问题。

现在已经有很多工具可以帮助完成这个任务。例如PDFBox（https://pdfbox.apache.org/）就是专门用来解析PDF文件的Java项目。
</code></pre>
<h3 id="2-2-2-Word、Excel文件"><a href="#2-2-2-Word、Excel文件" class="headerlink" title="2.2.2.Word、Excel文件"></a>2.2.2.Word、Excel文件</h3><p>Word是微软公司开发的字处理文件格式，以“doc”或者“docx”作为文件后缀名。Apache的POI（<a target="_blank" rel="noopener" href="http://poi.apache.org/%EF%BC%89%E5%8F%AF%E4%BB%A5%E7%94%A8%E6%9D%A5%E8%AF%BB%E5%8F%96Word%E6%96%87%E6%A1%A3%E3%80%82">http://poi.apache.org/）可以用来读取Word文档。</a><br>Excel也是微软公司开发的字处理文件格式，是由工作簿（Workbook）组成，工作簿由一个或多个工作表（Sheet）组成，每个工作表都有自己的名称，每个工作表又包含多个单元格（Cell）。除了POI项目，还有开源的jxl可以用来读写Excel。</p>
<h2 id="12-3-提取地域信息"><a href="#12-3-提取地域信息" class="headerlink" title="12.3.提取地域信息"></a>12.3.提取地域信息</h2><h3 id="2-3-1-ip地址"><a href="#2-3-1-ip地址" class="headerlink" title="2.3.1.ip地址"></a>2.3.1.ip地址</h3><p>网上有很多的服务商可以提供ip和地址的对应，可以通过这些服务商，根据ip获取到对应的地址。<br>有些服务商提供免费的ip库下载，例如纯真ip（<a target="_blank" rel="noopener" href="http://www.cz88.net/%EF%BC%89%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B9%9F%E5%8F%AF%E4%BB%A5%E7%94%A8%E5%85%B6%E4%BD%9C%E4%B8%BA%E7%A6%BB%E7%BA%BFip%E5%BA%93%EF%BC%8C%E5%B9%B6%E5%8A%A0%E4%BB%A5%E7%BB%B4%E6%8A%A4">http://www.cz88.net/），我们也可以用其作为离线ip库，并加以维护</a></p>
<h3 id="2-3-2-电话号码"><a href="#2-3-2-电话号码" class="headerlink" title="2.3.2.电话号码"></a>2.3.2.电话号码</h3><p>我们也可以通过手机电话号码的前七位确定其地址，或者通过其连接互联网使用的ip来进行查询</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">小逸</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2023/07/29/java%E7%88%AC%E8%99%AB/">http://example.com/2023/07/29/java%E7%88%AC%E8%99%AB/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">XYTX-荒岛</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a></div><div class="post_share"><div class="social-share" data-image="https://s3.bmp.ovh/imgs/2023/07/23/e724b3d3dbbd4e38.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/07/29/NoSQL%E6%A6%82%E8%BF%B0/" title="NoSQL概述"><img class="cover" src="https://s3.bmp.ovh/imgs/2023/07/23/a2d98510294bf4f0.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">NoSQL概述</div></div></a></div><div class="next-post pull-right"><a href="/2023/07/28/Spring%E6%95%B4%E5%90%88JDBC/" title="Spring整合JDBC"><img class="cover" src="https://s3.bmp.ovh/imgs/2023/07/23/3e31394d4aea8571.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring整合JDBC</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://s3.bmp.ovh/imgs/2023/07/21/9c73c560053d585c.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">小逸</div><div class="author-info__description">归途也可爱</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">10</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">9</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xytx223"><i class="fab fa-github"></i><span>我的GitHub</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">这是小逸同学的博客，欢迎大家来访问！</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-%E7%88%AC%E8%99%AB%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">1.爬虫基础概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1%E7%88%AC%E8%99%AB%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.1.</span> <span class="toc-text">1.1爬虫是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-%E7%88%AC%E8%99%AB%E8%A7%A3%E5%86%B3%E4%BA%86%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98"><span class="toc-number">2.2.</span> <span class="toc-text">1.2 爬虫解决了什么问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-2-%E6%95%B0%E6%8D%AE%E5%88%86%E4%B8%BA%E5%86%85%E9%83%A8%E6%95%B0%E6%8D%AE%E5%92%8C%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.1.</span> <span class="toc-text">1.2.2 数据分为内部数据和外部数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-1-%E5%85%AC%E5%8F%B8%E5%86%85%E9%83%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.1.1.</span> <span class="toc-text">1.2.2.1 公司内部数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-2-%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.1.2.</span> <span class="toc-text">1.2.2.2 外部数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-3-%E9%A2%9D%E5%A4%96%E6%89%A9%E5%B1%95"><span class="toc-number">2.2.1.3.</span> <span class="toc-text">1.2.2.3 额外扩展</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-%E7%88%AC%E8%99%AB%E4%B8%8E%E6%90%9C%E7%B4%A2%E7%B3%BB%E7%BB%9F%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">2.3.</span> <span class="toc-text">1.3 爬虫与搜索系统的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-%E7%88%AC%E8%99%AB%E7%9A%84%E7%AE%80%E5%8D%95%E5%88%86%E7%B1%BB"><span class="toc-number">2.4.</span> <span class="toc-text">1.4 爬虫的简单分类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-1%E9%80%9A%E7%94%A8%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span class="toc-number">2.4.1.</span> <span class="toc-text">1.4.1通用网络爬虫</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-2%E8%81%9A%E7%84%A6%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span class="toc-number">2.4.2.</span> <span class="toc-text">1.4.2聚焦网络爬虫</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-5-%E7%88%AC%E8%99%AB%E7%9A%84%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">1.5 爬虫的运行原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-1-%E7%88%AC%E8%99%AB%E5%BC%80%E5%8F%91%E6%9C%AC%E8%B4%A8%E6%98%AFHTTP%E8%AF%B7%E6%B1%82"><span class="toc-number">2.5.1.</span> <span class="toc-text">1.5.1 爬虫开发本质是HTTP请求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-2-HTTP%E5%B8%B8%E8%A7%81%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-number">2.5.2.</span> <span class="toc-text">1.5.2 HTTP常见状态码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-3-%E7%88%AC%E8%99%AB%E8%BF%90%E8%A1%8C%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">2.5.3.</span> <span class="toc-text">1.5.3 爬虫运行的原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-4-DNS%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E4%BA%86%E8%A7%A3"><span class="toc-number">2.5.4.</span> <span class="toc-text">1.5.4 DNS域名解析了解</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E5%B0%8Fdemo"><span class="toc-number">3.</span> <span class="toc-text">2.网络爬虫小demo</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-1-%E7%88%AC%E8%99%AB%E6%98%AF%E4%B8%BA%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E8%80%8C%E5%AD%98%E5%9C%A8%E7%9A%84"><span class="toc-number">3.0.1.</span> <span class="toc-text">1.2.1 爬虫是为获取数据而存在的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%88%AC%E8%99%AB%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.1.</span> <span class="toc-text">2.1.第一个爬虫程序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-1-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">3.1.1.</span> <span class="toc-text">2.1.1.环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-2-%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">3.1.2.</span> <span class="toc-text">2.1.2.创建工程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-3-%E5%8A%A0%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">3.1.3.</span> <span class="toc-text">2.1.3.加入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-4-%E5%8A%A0%E5%85%A5log4j-properties"><span class="toc-number">3.1.4.</span> <span class="toc-text">2.1.4.加入log4j.properties</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-5-%E7%BC%96%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-number">3.1.5.</span> <span class="toc-text">2.1.5.编写代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span class="toc-number">4.</span> <span class="toc-text">3.网络爬虫</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.</span> <span class="toc-text">3.1.网络爬虫介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E5%AD%A6%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span class="toc-number">4.2.</span> <span class="toc-text">3.2.为什么学网络爬虫</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-HttpClient"><span class="toc-number">5.</span> <span class="toc-text">4.HttpClient</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-GET%E8%AF%B7%E6%B1%82"><span class="toc-number">5.1.</span> <span class="toc-text">4.1.GET请求</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84GET%E8%AF%B7%E6%B1%82"><span class="toc-number">5.1.1.</span> <span class="toc-text">4.2.带参数的GET请求</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-POST%E8%AF%B7%E6%B1%82"><span class="toc-number">5.2.</span> <span class="toc-text">4.3.POST请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-4-%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84POST%E8%AF%B7%E6%B1%82"><span class="toc-number">5.2.0.1.</span> <span class="toc-text">4.4.带参数的POST请求</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">5.2.1.</span> <span class="toc-text">4.5.连接池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-number">5.2.2.</span> <span class="toc-text">4.6.请求参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-Jsoup"><span class="toc-number">6.</span> <span class="toc-text">5.Jsoup</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-jsoup%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.1.</span> <span class="toc-text">5.1.jsoup介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-jsoup%E8%BE%93%E5%85%A5"><span class="toc-number">6.2.</span> <span class="toc-text">5.2.jsoup输入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-%E8%BE%93%E5%85%A5url"><span class="toc-number">6.2.0.1.</span> <span class="toc-text">5.2.1.输入url</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-%E8%BE%93%E5%85%A5%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">6.2.1.</span> <span class="toc-text">5.2.2.输入字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-%E8%BE%93%E5%85%A5%E6%96%87%E4%BB%B6"><span class="toc-number">6.2.2.</span> <span class="toc-text">5.2.3.输入文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-Jsoup%E8%A7%A3%E6%9E%90"><span class="toc-number">6.3.</span> <span class="toc-text">5.3.Jsoup解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-1-%E4%BD%BF%E7%94%A8dom%E6%96%B9%E5%BC%8F%E9%81%8D%E5%8E%86%E6%96%87%E6%A1%A3"><span class="toc-number">6.3.1.</span> <span class="toc-text">5.3.1.使用dom方式遍历文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-2-%E4%BD%BF%E7%94%A8%E9%80%89%E6%8B%A9%E5%99%A8%E8%AF%AD%E6%B3%95%E6%9F%A5%E6%89%BE%E5%85%83%E7%B4%A0"><span class="toc-number">6.3.2.</span> <span class="toc-text">5.3.2.使用选择器语法查找元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-3-Selector%E9%80%89%E6%8B%A9%E5%99%A8%E6%A6%82%E8%BF%B0"><span class="toc-number">6.3.3.</span> <span class="toc-text">5.3.3.Selector选择器概述</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-1-Selector%E9%80%89%E6%8B%A9%E5%99%A8%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8"><span class="toc-number">6.3.3.1.</span> <span class="toc-text">5.3.3.1.Selector选择器组合使用</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-%E7%88%AC%E8%99%AB%E5%88%86%E7%B1%BB"><span class="toc-number">7.</span> <span class="toc-text">6.爬虫分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E9%80%9A%E7%94%A8%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span class="toc-number">7.1.</span> <span class="toc-text">6.1.通用网络爬虫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E8%81%9A%E7%84%A6%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span class="toc-number">7.2.</span> <span class="toc-text">6.2.聚焦网络爬虫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-%E5%A2%9E%E9%87%8F%E5%BC%8F%E7%BD%91%E7%BB%9C%E7%88%AC%E8%99%AB"><span class="toc-number">7.3.</span> <span class="toc-text">6.3.增量式网络爬虫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-Deep-Web-%E7%88%AC%E8%99%AB"><span class="toc-number">7.4.</span> <span class="toc-text">6.4.Deep Web 爬虫</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-%E6%A1%88%E4%BE%8B%E9%9C%80%E6%B1%82"><span class="toc-number">8.</span> <span class="toc-text">7.案例需求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#8-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">9.</span> <span class="toc-text">8.环境准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E6%90%AD%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-number">9.1.</span> <span class="toc-text">8.1.搭建工程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-%E5%8A%A0%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">9.1.1.</span> <span class="toc-text">8.1.1.加入依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-%E5%8A%A0%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-number">9.1.2.</span> <span class="toc-text">8.1.2.加入配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-SpringBoot%E5%85%A5%E9%97%A8"><span class="toc-number">9.2.</span> <span class="toc-text">8.2.SpringBoot入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-1-%E7%BC%96%E5%86%99%E5%BC%95%E5%AF%BC%E7%B1%BB"><span class="toc-number">9.2.1.</span> <span class="toc-text">8.2.1.编写引导类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-2-%E7%BC%96%E5%86%99Mapper"><span class="toc-number">9.2.2.</span> <span class="toc-text">8.2.2.编写Mapper</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-3-%E7%BC%96%E5%86%99Service%E6%8E%A5%E5%8F%A3"><span class="toc-number">9.2.3.</span> <span class="toc-text">8.2.3.编写Service接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-4-%E7%BC%96%E5%86%99Service%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.2.4.</span> <span class="toc-text">8.2.4.编写Service实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-5-%E7%BC%96%E5%86%99Controller"><span class="toc-number">9.2.5.</span> <span class="toc-text">8.2.5.编写Controller</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#9-%E5%BC%80%E5%8F%91%E5%88%86%E6%9E%90"><span class="toc-number">10.</span> <span class="toc-text">9.开发分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#9-1-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90"><span class="toc-number">10.1.</span> <span class="toc-text">9.1.流程分析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-2-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">10.2.</span> <span class="toc-text">9.2.数据库表设计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-3-%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87"><span class="toc-number">10.3.</span> <span class="toc-text">9.3.开发准备</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#10-%E5%AE%9E%E7%8E%B0%E7%88%AC%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">11.</span> <span class="toc-text">10.实现爬取数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#10-1-%E5%AE%9E%E7%8E%B0ApiService"><span class="toc-number">11.1.</span> <span class="toc-text">10.1.实现ApiService</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-1-%E7%BC%96%E5%86%99%E8%BF%9E%E6%8E%A5%E6%B1%A0%E7%AE%A1%E7%90%86%E5%99%A8"><span class="toc-number">11.1.1.</span> <span class="toc-text">10.1.1.编写连接池管理器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-2-%E5%AE%9A%E6%97%B6%E5%85%B3%E9%97%AD%E5%A4%B1%E6%95%88%E8%BF%9E%E6%8E%A5"><span class="toc-number">11.1.2.</span> <span class="toc-text">10.1.2.定时关闭失效连接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-2-1-%E7%BC%96%E5%86%99%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">11.1.2.1.</span> <span class="toc-text">10.1.2.1.编写定时任务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-1-2-2-%E5%AE%9A%E6%97%B6%E6%89%A7%E8%A1%8C%E4%BB%BB%E5%8A%A1"><span class="toc-number">11.1.2.2.</span> <span class="toc-text">10.1.2.2.定时执行任务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-3-%E7%BC%96%E5%86%99ApiService%E6%8E%A5%E5%8F%A3"><span class="toc-number">11.1.3.</span> <span class="toc-text">10.1.3.编写ApiService接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-4-%E5%AE%9E%E7%8E%B0ApiService%E6%8E%A5%E5%8F%A3"><span class="toc-number">11.1.4.</span> <span class="toc-text">10.1.4.实现ApiService接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-5-%E6%B5%8B%E8%AF%95ApiService%E6%8E%A5%E5%8F%A3"><span class="toc-number">11.1.5.</span> <span class="toc-text">10.1.5.测试ApiService接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-2-%E5%8E%BB%E9%87%8D%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.2.</span> <span class="toc-text">10.2.去重过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-1-Bloom%E8%BF%87%E6%BB%A4%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="toc-number">11.2.1.</span> <span class="toc-text">10.2.1.Bloom过滤器介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-2-%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.2.2.</span> <span class="toc-text">10.2.2.布隆过滤器实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-3-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%8E%BB%E9%87%8D%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">11.2.3.</span> <span class="toc-text">10.2.3.初始化去重过滤器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-3-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E7%88%AC%E5%8F%96"><span class="toc-number">11.3.</span> <span class="toc-text">10.3.实现数据爬取</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-1-%E5%AE%9E%E7%8E%B0%E7%88%AC%E5%8F%96%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-number">11.3.1.</span> <span class="toc-text">10.3.1.实现爬取测试方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-2-%E7%BC%96%E5%86%99CarTestService%E6%8E%A5%E5%8F%A3"><span class="toc-number">11.3.2.</span> <span class="toc-text">10.3.2.编写CarTestService接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-3-%E7%BC%96%E5%86%99CarTestService%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="toc-number">11.3.3.</span> <span class="toc-text">10.3.3.编写CarTestService接口实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-4-%E7%BC%96%E5%86%99CarTestMapper"><span class="toc-number">11.3.4.</span> <span class="toc-text">10.3.4.编写CarTestMapper</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-4-%E6%95%B4%E5%90%88%E4%BB%BB%E5%8A%A1"><span class="toc-number">11.4.</span> <span class="toc-text">10.4.整合任务</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-1-%E6%94%B9%E9%80%A0%E4%BB%BB%E5%8A%A1"><span class="toc-number">11.4.1.</span> <span class="toc-text">10.4.1.改造任务</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-4-2-%E5%AE%9A%E6%97%B6%E5%A4%84%E7%90%86%E4%BB%BB%E5%8A%A1"><span class="toc-number">11.4.2.</span> <span class="toc-text">10.4.2.定时处理任务</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#11-%E5%8A%A8%E6%80%81%E7%BD%91%E9%A1%B5"><span class="toc-number">12.</span> <span class="toc-text">11.动态网页</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#11-1-phantomJs-selenium"><span class="toc-number">12.1.</span> <span class="toc-text">11.1.phantomJs+selenium</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-2-%E5%8A%A0%E5%85%A5%E4%BE%9D%E8%B5%96"><span class="toc-number">12.2.</span> <span class="toc-text">11.2.加入依赖</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-3-%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="toc-number">12.3.</span> <span class="toc-text">11.3.测试代码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E7%88%AC%E8%99%AB%E6%94%BB%E9%98%B2%E6%8A%80%E6%9C%AF"><span class="toc-number">13.</span> <span class="toc-text">12.爬虫攻防技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1%E5%A6%82%E4%BD%95%E8%AF%86%E5%88%AB%E7%88%AC%E8%99%AB"><span class="toc-number">13.1.</span> <span class="toc-text">12.1如何识别爬虫</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-1-%E5%A6%82%E4%BD%95%E5%8F%91%E7%8E%B0%E7%88%AC%E8%99%AB"><span class="toc-number">13.2.</span> <span class="toc-text">12.1.1 如何发现爬虫</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-2-%E5%A6%82%E4%BD%95%E9%81%BF%E5%85%8D%E8%A2%AB%E5%8F%91%E7%8E%B0"><span class="toc-number">13.2.1.</span> <span class="toc-text">12.1.2 如何避免被发现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-3-%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86IP%E7%BB%95%E8%BF%87%E7%88%AC%E8%99%AB%E7%AD%96%E7%95%A5"><span class="toc-number">13.2.2.</span> <span class="toc-text">12.1.3 使用代理IP绕过爬虫策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E4%BB%A3%E7%90%86IP%E7%BB%95%E8%BF%87%E7%BD%91%E7%AB%99%E7%9B%91%E6%B5%8B"><span class="toc-number">13.3.</span> <span class="toc-text">12.2 如何使用代理IP绕过网站监测</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-4%E5%A6%82%E4%BD%95%E7%BB%95%E8%BF%87%E7%BD%91%E7%AB%99%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">13.4.</span> <span class="toc-text">12.4	如何绕过网站验证码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-4-1%E4%B8%80%E4%BA%9B%E7%BB%8F%E9%AA%8C"><span class="toc-number">13.4.1.</span> <span class="toc-text">12.4.1一些经验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#12-%E5%85%B6%E4%BB%96%E4%BF%A1%E6%81%AF%E6%8F%90%E5%8F%96"><span class="toc-number">14.</span> <span class="toc-text">12.其他信息提取</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#12-1-%E5%9B%BE%E5%83%8F%E7%9A%84OCR%E8%AF%86%E5%88%AB"><span class="toc-number">14.1.</span> <span class="toc-text">12.1.图像的OCR识别</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-1-OCR%E4%BB%8B%E7%BB%8D"><span class="toc-number">14.1.1.</span> <span class="toc-text">12.1.1.OCR介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-2-Tess4j"><span class="toc-number">14.1.2.</span> <span class="toc-text">12.1.2.Tess4j</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-3-%E4%BD%BF%E7%94%A8%E7%AC%AC%E4%B8%89%E6%96%B9%E6%9C%8D%E5%8A%A1%E8%AF%86%E5%88%AB%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">14.1.3.</span> <span class="toc-text">12.1.3 使用第三方服务识别验证码</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-2-%E4%BB%8E%E9%9D%9Ehtml%E6%8F%90%E5%8F%96%E6%96%87%E6%9C%AC"><span class="toc-number">14.2.</span> <span class="toc-text">12.2.从非html提取文本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-1-PDF%E6%96%87%E4%BB%B6"><span class="toc-number">14.2.1.</span> <span class="toc-text">12.2.1.PDF文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-2-Word%E3%80%81Excel%E6%96%87%E4%BB%B6"><span class="toc-number">14.2.2.</span> <span class="toc-text">2.2.2.Word、Excel文件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-3-%E6%8F%90%E5%8F%96%E5%9C%B0%E5%9F%9F%E4%BF%A1%E6%81%AF"><span class="toc-number">14.3.</span> <span class="toc-text">12.3.提取地域信息</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-1-ip%E5%9C%B0%E5%9D%80"><span class="toc-number">14.3.1.</span> <span class="toc-text">2.3.1.ip地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-2-%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81"><span class="toc-number">14.3.2.</span> <span class="toc-text">2.3.2.电话号码</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/07/29/Mybatis/" title="Mybatis"><img src="https://s3.bmp.ovh/imgs/2023/07/23/bca965c139074b63.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mybatis"/></a><div class="content"><a class="title" href="/2023/07/29/Mybatis/" title="Mybatis">Mybatis</a><time datetime="2023-07-29T10:27:48.000Z" title="发表于 2023-07-29 18:27:48">2023-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/29/NoSQL%E6%A6%82%E8%BF%B0/" title="NoSQL概述"><img src="https://s3.bmp.ovh/imgs/2023/07/23/a2d98510294bf4f0.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="NoSQL概述"/></a><div class="content"><a class="title" href="/2023/07/29/NoSQL%E6%A6%82%E8%BF%B0/" title="NoSQL概述">NoSQL概述</a><time datetime="2023-07-29T10:25:46.000Z" title="发表于 2023-07-29 18:25:46">2023-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/29/java%E7%88%AC%E8%99%AB/" title="java爬虫"><img src="https://s3.bmp.ovh/imgs/2023/07/23/e724b3d3dbbd4e38.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="java爬虫"/></a><div class="content"><a class="title" href="/2023/07/29/java%E7%88%AC%E8%99%AB/" title="java爬虫">java爬虫</a><time datetime="2023-07-29T10:18:08.000Z" title="发表于 2023-07-29 18:18:08">2023-07-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/28/Spring%E6%95%B4%E5%90%88JDBC/" title="Spring整合JDBC"><img src="https://s3.bmp.ovh/imgs/2023/07/23/3e31394d4aea8571.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring整合JDBC"/></a><div class="content"><a class="title" href="/2023/07/28/Spring%E6%95%B4%E5%90%88JDBC/" title="Spring整合JDBC">Spring整合JDBC</a><time datetime="2023-07-28T14:13:58.000Z" title="发表于 2023-07-28 22:13:58">2023-07-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/07/28/%E8%81%8A%E8%81%8AJavaScript/" title="聊聊JavaScript"><img src="https://s3.bmp.ovh/imgs/2023/07/23/ca01178e11d8b630.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="聊聊JavaScript"/></a><div class="content"><a class="title" href="/2023/07/28/%E8%81%8A%E8%81%8AJavaScript/" title="聊聊JavaScript">聊聊JavaScript</a><time datetime="2023-07-28T14:12:46.000Z" title="发表于 2023-07-28 22:12:46">2023-07-28</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2016 - 2023 By 小逸</div><div class="framework-info"><span>小逸博客 </span><a target="_blank" rel="noopener" href="https://xytx223.eu.org">xytx</a><span class="footer-separator">|</span><span>技术支持 </span><a target="_blank" rel="noopener" href="https://xytx223.cn">小逸工作室</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>